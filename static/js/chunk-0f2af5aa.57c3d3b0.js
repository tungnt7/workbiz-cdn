(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f2af5aa"],{"02d1":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible,width:"400px","append-to-body":""},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{"label-position":"top","label-width":"160px",size:"small"}},[s("div",{staticClass:"form-item"},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:t.type,format:"dd-MM-yyyy","value-format":"timestamp","picker-options":t.pickerOptions},model:{value:t.datetimeRange,callback:function(e){t.datetimeRange=e},expression:"datetimeRange"}})],1)]),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v("Xác nhận")])],1)],1)},i=[],n=(s("d3b7"),s("b199")),r=s("24d2"),o={name:"DeadlineDialog",props:{type:{type:String,default:"daterange"},executeFor:{type:String,default:"task"},title:{type:String,default:"Thời gian bắt đâu - thời gian kết thúc"}},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,datetimeRange:"",offsetTime:25200}},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},taskId:function(){return this.selectedTask.task_id},selectedProject:{get:function(){return this.$store.getters.selectedProject},set:function(t){this.$store.dispatch("project/setSelectedProject",t)}},pickerOptions:function(){var t=this;return{disabledDate:function(e){var s=new Date;return s.setDate(s.getDate()-1),"daterange"!==t.type&&t.selectedTask&&t.selectedTask.deadline_from&&"project"!==t.executeFor&&(s=t.$moment(t.selectedTask.deadline_from)),"daterange"!==t.type&&"project"===t.executeFor&&t.selectedProject&&t.selectedProject.deadline_from&&(s=t.$moment(t.selectedProject.deadline_from)),e.getTime()<s}}}},created:function(){},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},disabledDate:function(t){var e=new Date;return e.setDate(e.getDate()-1),t.getTime()<e},handleCreateOrUpdate:function(){var t=this,e=this.selectedTask,s=this.executeFor,a=this.datetimeRange,i=this.taskId;if(!i&&"project"!==s)return this.$emit("passDeadline",a),this.hideDialog(),void(this.datetimeRange="");this.loadingBtn=!0;var o=this.selectedProject,c={};"daterange"===this.type&&(c.deadline_from=a[0],c.deadline_to=a[1]),"date"===this.type&&(c.deadline_to=a),"task"===s?(c.deadline_from=c.deadline_from/1e3+this.offsetTime,c.deadline_to=c.deadline_to/1e3+this.offsetTime,Object(n["s"])(e.task_id,c).then((function(e){var s=e.data;t.loading=!1,t.selectedTask=s,t.deadlineValue="",t.$message({type:"success",message:"Thành công"}),t.hideDialog()})).finally((function(){t.loadingBtn=!1}))):Object(r["m"])(o.project_id,c).then((function(e){var s=e.data,a=s.deadline_from,i=s.deadline_to;t.loading=!1,o.deadline_from=a,o.deadline_to=i,t.selectedProject=o,t.deadlineValue="",t.$message({type:"success",message:"Thành công"}),t.hideDialog()})).finally((function(){t.loadingBtn=!1})),this.datetimeRange=""}}},c=o,l=s("2877"),d=Object(l["a"])(c,a,i,!1,null,"099c0afc",null);e["a"]=d.exports},"0526":function(t,e,s){},"062d":function(t,e,s){},"0688":function(t,e,s){"use strict";s("60b0")},"06dd":function(t,e,s){"use strict";s("2a6c")},"0964":function(t,e,s){"use strict";s("6b94")},"0d02":function(t,e,s){"use strict";s("c5aa")},"0da0":function(t,e,s){"use strict";s("959a")},"0f0b":function(t,e,s){},"154d":function(t,e,s){"use strict";s("c749")},1998:function(t,e,s){"use strict";s("d1b2")},"1a7c":function(t,e,s){},"1a82":function(t,e,s){},2296:function(t,e,s){"use strict";s("aea2")},"24e0":function(t,e,s){},"26dc":function(t,e,s){"use strict";s("7a16")},"271d":function(t,e,s){},"2a6c":function(t,e,s){},"2aa9":function(t,e,s){"use strict";s("8baf")},"2af7":function(t,e,s){"use strict";s("cbf2")},"2be1":function(t,e,s){},"2e25":function(t,e,s){"use strict";s("062d")},3220:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-state inline task-info"},[s("el-popover",{attrs:{placement:"bottom",width:"120",trigger:"click","popper-class":"custom-popover","visible-arrow":!1},model:{value:t.showList,callback:function(e){t.showList=e},expression:"showList"}},[s("div",{staticClass:"list",class:2==t.taskData.confirm_status?"":"state-disabled ",attrs:{title:2==t.taskData.confirm_status?"":"Công việc chưa được xác nhận"}},[s("ul",t._l(t.states,(function(e){return s("li",{key:e.value,on:{click:function(s){return t.handleChangeState(e.value)}}},[s("a",[t._v(t._s(e.title))])])})),0)]),t.state?s("span",{staticClass:"state",class:"state-"+t.state,attrs:{slot:"reference"},on:{click:t.toggleList},slot:"reference"},[t._v(t._s(t.getStateTextById(t.state))+" "),s("span",{staticClass:"arrow",on:{click:t.toggleList}},[s("svg-icon",{attrs:{"icon-class":"expand_more_gray"}})],1)]):t._e()])],1)},i=[],n=(s("d3b7"),s("b199")),r=s("cc1d"),o=s("323e"),c=s.n(o),l={props:{task:{type:Object,default:function(){}}},data:function(){return{showList:!1,taskData:this.task}},computed:{state:{get:function(){if(!this.taskData.deadline_to)return this.taskData.state;var t=this.$moment(this.taskData.deadline_to),e=this.$moment(this.taskData.done_at),s=this.$moment();return this.taskData.state===r["b"]&&this.$moment.duration(e.diff(t)).seconds()>0?r["c"]:(this.taskData.state===r["f"]||this.taskData.state===r["h"])&&this.$moment.duration(s.diff(t)).seconds()>0?r["j"]:this.taskData.state},set:function(){var t=this.task_id,e=this.state;this.$store.dispatch("task/updateTasks",{task_id:t,key:"state",value:e})}},task_id:function(){return this.taskData.task_id},states:function(){return Object(r["t"])()}},watch:{task:function(t){this.taskData=t}},methods:{getStateList:r["t"],getStateTextById:r["u"],toggleList:function(){},handleChangeState:function(t){var e=this,s=this.task_id,a=this.state;if(a===t)return this.showList=!1;var i={state:t};c.a.start(),Object(n["s"])(s,i).then((function(s){e.state=t,e.showList=!1;var a=s.data;e.taskData=a,e.$store.dispatch("project/setSelectedProject",null),e.$store.dispatch("task/setSelectedTask",a),e.$store.dispatch("project/setSelectedProjectId",e.taskData.project_id),e.$store.dispatch("taskGroup/fetchTaskGroupsByProjectId",{projectId:e.taskData.project_id}),e.$store.dispatch("report/fetchReport",{projectId:e.$route.params.projectId}),e.$message.success("Cập nhật thành công"),e.$emit("afterUpdate")})).finally((function(){c.a.done()}))}}},d=l,u=(s("ebb7"),s("2877")),h=Object(u["a"])(d,a,i,!1,null,null,null);e["a"]=h.exports},"32b5":function(t,e,s){},"33f3":function(t,e,s){},"38b4":function(t,e,s){"use strict";s("ee40")},3938:function(t,e,s){"use strict";s("4ca6")},"3b86":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticClass:"avatar"},[t.user?a("el-tooltip",{attrs:{content:t.user.name,placement:"right",effect:"light"}},[t.user.avatar_full_url?a("img",{style:{width:t.width+"px",height:t.width+"px",borderRadius:t.borderRadius+"%",objectFit:"cover"},attrs:{src:t.user.avatar_full_url}}):a("span",{staticClass:"no-image",style:{width:t.width+"px",height:t.width+"px",fontSize:"9px",fontWeight:"bold",lineHeight:t.lineHeight+"px",borderRadius:t.borderRadius+"%",border:"0.5px solid #FFFFFF",display:"flex",justifyContent:"center",alignItems:"center",fontSize:t.fontSize+"px",background:t.arrColor[t.arrKeyword.indexOf(t.user.name.slice(0,1).toUpperCase())]}},[t._v(t._s(t.user.name.slice(0,1).toUpperCase()))])]):a("img",{staticClass:"cursor-pointer",style:{width:t.width+"px",height:t.width+"px",borderRadius:t.borderRadius+"px",objectFit:"cover"},attrs:{src:s("db37"),title:"Chưa giao"}})],1)},i=[],n=(s("a9e3"),{props:{user:{type:Object,default:function(){}},width:{type:Number,default:24},fontSize:{type:Number,default:12},lineHeight:{type:Number,default:24},borderRadius:{type:Number,default:5}},data:function(){return{arrColor:["#FF5733","#008080","#00FFFF","#2F4F4F","#FF0000","#800080","#CD5C5C","#DC143C","#8A2BE2","#A52A2A","#21618C","#556B2F","#FF1493","#DAA520","#4B0082","#191970","#C71585","#FFA500","#FF4500","#800080","#8B4513","#4169E1","#FA8072","#3498DB","#6A5ACD","#008080","#9ACD32","#2F4F4F","#228B22","rgba(68, 68, 68, 0.8)"],arrKeyword:["A","Ă","Â","B","C","D","Đ","E","Ê","G","H","I","K","L","M","N","O","Ô","Ơ","P","Q","R","S","T","U","Ư","V","X","Y",""]}}}),r=n,o=(s("c1f2"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,"335fd602",null);e["a"]=c.exports},"3cd4":function(t,e,s){},4636:function(t,e,s){"use strict";s("2be1")},"490f":function(t,e,s){"use strict";s("d46a")},"4bae":function(t,e,s){"use strict";s("8acd")},"4ca6":function(t,e,s){},"4f4e":function(t,e,s){t.exports=s.p+"static/img/checked.330f6b1a.png"},"509a":function(t,e,s){"use strict";s("24e0")},"50a7":function(t,e,s){},"5d7a":function(t,e,s){"use strict";s("df10")},"60b0":function(t,e,s){},6256:function(t,e,s){},6318:function(t,e,s){},"63f2":function(t,e,s){"use strict";s("271d")},6436:function(t,e,s){"use strict";s("32b5")},6580:function(t,e,s){},6732:function(t,e,s){"use strict";s("db7d")},"6b0d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.user?s("div",{staticClass:"user-block"},[s("user-avatar",{attrs:{user:t.user,width:35,"font-size":18,"line-height":35,"border-radius":50}}),s("div",{staticClass:"user-info"},[s("span",{staticClass:"username"},[t._v(t._s(t.user.name))]),s("span",{staticClass:"user-title"},[t._v(t._s(t.user.map_user_group?t.user.map_user_group.name:t.isUserGroup?"":"Chưa có bộ phận"))])]),t.showDelete?s("span",{staticClass:"delete"},[t.isUserGroup?[t.currentUserLeader?s("span",{attrs:{title:"Xóa"},on:{click:t.userGroupDelete}},[s("i",{staticClass:"el-icon-delete"})]):t._e()]:[s("el-dropdown",{on:{command:t.handleCommand}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-more"})]),s("el-dropdown-menu",{staticClass:"dd-members",attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"profile"}},[s("div",{staticClass:"dd-members__item dd-members__item--profile"},[s("i",{staticClass:"el-icon-user-solid"}),t._v(" Xem trang cá nhân ")])]),t.currentUserLeader?s("el-dropdown-item",{attrs:{command:"role"}},[s("div",{staticClass:"dd-members__item dd-members__item--role"},[s("i",{staticClass:"el-icon-close"}),t._v(" "+t._s(t.role)+" ")])]):t._e(),t.currentUserLeader?s("el-dropdown-item",{attrs:{command:"remove"}},[s("div",{staticClass:"dd-members__item dd-members__item--remove"},[s("i",{staticClass:"el-icon-delete"}),t._v(" Xóa khỏi dự án ")])]):t._e()],1)],1)]],2):t._e()],1):t._e()},i=[],n=s("1da1"),r=(s("b0c0"),s("96cf"),s("3b86")),o={name:"TaskRefUser",components:{UserAvatar:r["a"]},props:{user:{type:Object,default:function(){}},showDelete:{type:Boolean,default:!1},isLeader:{type:Boolean,default:!0},isUserGroup:{type:Boolean,default:!1},currentUserLeader:{type:Boolean,default:!1}},computed:{role:function(){return this.isLeader?"Bỏ quyền quản lý":"Set quyền quản lý"}},methods:{removeItem:function(){var t=this;this.$confirm("Xác nhận xóa người theo dõi?","Warning",{confirmButtonText:"Xác nhận",cancelButtonText:"Đóng",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$emit("eventDelete",t.user,!0);case 1:case"end":return e.stop()}}),e)})))).catch((function(){}))},handleCommand:function(t){switch(t){case"profile":this.$router.push("/profile/index");break;case"role":this.$emit("eventGetSetRole",this.user,this.isLeader);break;default:this.removeItem();break}},userGroupDelete:function(){confirm("Bạn chắc chắn muốn xóa bộ phận "+this.user.name+" không?")&&this.$emit("eventDelete",this.user,!0)}}},c=o,l=(s("f1af"),s("2877")),d=Object(l["a"])(c,a,i,!1,null,"74c7c98a",null);e["a"]=d.exports},"6b94":function(t,e,s){},"6c00":function(t,e,s){"use strict";s("1a7c")},"6d10":function(t,e,s){},"6d28":function(t,e,s){"use strict";s("f27c")},"6faa":function(t,e,s){"use strict";s("9292")},7244:function(t,e,s){},"72dd":function(t,e,s){"use strict";s("b805")},"74a3":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-page-info task-bar"},[s("el-collapse",{model:{value:t.activeName1,callback:function(e){t.activeName1=e},expression:"activeName1"}},[s("el-collapse-item",{attrs:{title:"Chọn mục tiêu",name:"1"}},[s("div",{staticClass:"collapse-content-wrapper"},[s("div",{staticClass:"collapse-content"},[s("div",{staticClass:"box-target"},[t.task&&t.task.target?s("div",{staticClass:"target"},[s("span",{staticClass:"icon"},[s("svg-icon",{attrs:{"icon-class":"flag"}})],1),s("div",{staticClass:"title"},[s("a",[t._v(t._s(t.task?t.task.target.name:""))])])]):s("div",{staticClass:"target no-target"},[s("span",{staticClass:"icon"},[s("svg-icon",{attrs:{"icon-class":"warning"}})],1),s("div",{staticClass:"title"},[t._v("Chưa liên kết mục tiêu")])]),s("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click","popper-class":"no-padding","visible-arrow":!1}},[s("target-list-select",{on:{showTargetFromDialog:t.handleOpenTargetFormDialog}}),s("a",{staticClass:"choose-target",attrs:{slot:"reference"},slot:"reference"},[t._v(" "+t._s(t.task&&t.task.target?"Chọn lại mục tiêu":"Lựa chọn mục tiêu")+" "),s("svg-icon",{attrs:{"icon-class":"expand_right"}})],1)],1)],1)])])])],1),t.task?s("div",{staticClass:"task-timeline"},[s("div",{staticClass:"task-timeline-item"},[s("span",{staticClass:"task-timeline-icon"},[s("svg-icon",{attrs:{"icon-class":"access_time"}})],1),s("span",{staticClass:"task-timeline-title"},[t._v("Thời gian tạo:")]),s("span",{staticClass:"task-timeline-value"},[t._v(t._s(t.formatDate(t.task.created_at,t.optionalDate)))])]),s("div",{staticClass:"task-timeline-item"},[s("span",{staticClass:"task-timeline-icon"},[s("svg-icon",{attrs:{"icon-class":"access_time_1"}})],1),s("span",{staticClass:"task-timeline-title"},[t._v("TG cập nhật cuối:")]),s("span",{staticClass:"task-timeline-value"},[t._v(t._s(t.formatDate(t.task.updated_at,t.optionalDate)))])]),s("div",{staticClass:"task-timeline-item"},[s("span",{staticClass:"task-timeline-icon"},[s("svg-icon",{attrs:{"icon-class":"access_time_2"}})],1),s("span",{staticClass:"task-timeline-title"},[t._v("Thời gian bắt đầu:")]),s("span",{staticClass:"task-timeline-value"},[t._v(t._s(t.formatDate(t.task.deadline_from,t.optionalDate)))])]),s("div",{staticClass:"task-timeline-item"},[s("span",{staticClass:"task-timeline-icon"},[s("svg-icon",{attrs:{"icon-class":"timelapse"}})],1),s("span",{staticClass:"task-timeline-title"},[t._v("Thời gian cho phép:")]),s("span",{staticClass:"task-timeline-value"},[t._v(t._s(t.task.duration?t.task.duration+"h":"-"))])])]):t._e(),s("el-collapse",{model:{value:t.activeName1,callback:function(e){t.activeName1=e},expression:"activeName1"}},[s("el-collapse-item",{attrs:{title:"Người giao việc",name:"2"}},[s("div",{staticClass:"collapse-content-wrapper"},[s("div",{staticClass:"collapse-content"},[s("user-block",{attrs:{user:t.user}})],1)])]),s("el-collapse-item",{attrs:{title:"Người theo dõi",name:"3"}},[s("div",{staticClass:"collapse-content-wrapper"},[s("div",{staticClass:"collapse-content"},[s("div",{staticClass:"list-refs"},t._l(t.ref_users,(function(e){return s("user-block",{key:"ref"+e.user_id,attrs:{user:e,"show-delete":!0},on:{eventDelete:t.handleChooseUser}})})),1),s("div",{staticClass:"action"},[s("user-tag-popover",{attrs:{title:"Thêm người theo dõi"},on:{chooseUser:t.handleChooseUser}})],1)])])]),s("el-collapse-item",{attrs:{title:"Lịch sử hoạt động",name:"4"}},[s("div",{staticClass:"collapse-content-wrapper"},[s("div",{staticClass:"collapse-content"},[s("div",{staticClass:"activity-list custom-scroll ww-scroll",attrs:{"infinite-scroll-disabled":"disabled"}},t._l(t.activities,(function(e){return s("div",{key:e.activity_id,staticClass:"activity-item"},[s("span",{staticClass:"avatar"},[s("user-avatar",{attrs:{user:e.user,"border-radius":50}})],1),s("div",{staticClass:"content"},[s("strong",[t._v(t._s(e.user?e.user.name:"Admin"))]),t._v(" đã "),s("span",{domProps:{innerHTML:t._s(e?e.message:"")}})]),s("div",{staticClass:"create_at"},[s("span",[t._v(t._s(t._f("humanizeVN")(e&&e.created_at)))]),e&&e.show_detail?s("a",{staticStyle:{float:"right"},on:{click:function(s){return t.handleShowDialog(e)}}},[t._v("Chi tiết")]):t._e()])])})),0)])])])],1),s("target-form-dialog",{ref:"target_form_dialog"}),s("el-dialog",{attrs:{title:"Chi tiết hoạt động",visible:t.showActivityDialog},on:{"update:visible":function(e){t.showActivityDialog=e}}},[s("div",{staticClass:"header"},[s("strong",[t._v(t._s(t.dialogActivity.user?t.dialogActivity.user.name:"N"))]),t._v(" đã "),s("span",{domProps:{innerHTML:t._s(t.dialogActivity.message)}})]),s("hr"),s("div",{staticClass:"content"},[s("h5",[t._v("Giá trị cũ")]),s("div",{domProps:{innerHTML:t._s(t.dialogActivity.old_data)}}),s("hr"),s("h5",[t._v("Giá trị mới")]),s("div",{domProps:{innerHTML:t._s(t.dialogActivity.new_data)}})])])],1)},i=[],n=s("2909"),r=s("1da1"),o=(s("a434"),s("d3b7"),s("96cf"),s("6b0d")),c=s("3b86"),l=s("8c61"),d=s("b199"),u=s("323e"),h=s.n(u),m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"tag-wrapper"},[s("div",{staticClass:"tag-header"},[s("h3",{staticClass:"custom-title"},[t._v("Chọn mục tiêu")]),s("span",{staticClass:"add-tag"},[s("svg-icon",{attrs:{"icon-class":"plus"},on:{click:t.handleOpenTargetDialog}})],1)]),s("div",{staticClass:"tag-list target-list custom-scroll"},t._l(t.current_project_targets,(function(e){return s("div",{key:e.target_id,staticClass:"item",class:{active:t.checkTargetSelect(e),"on-date":t.checkTargetOndate(e)},on:{click:function(s){return t.chooseTarget(e.target_id)}}},[s("span",{staticClass:"box-color"}),s("span",{staticClass:"tag-name"},[t._v(t._s(e.name))])])})),0)])])},p=[],f=(s("f6d4"),{name:"TargetListSelect",props:{},components:{},data:function(){return{targets:[]}},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},taskId:function(){return this.$store.getters.selectedTaskId},target:function(){var t=this.selectedTask;if(t)return t.target},projectId:function(){var t=this.selectedTask;return t&&t.project?t.project.project_id:0},current_project_targets:{get:function(){return this.$store.getters.current_project_targets},set:function(t){this.$store.dispatch("task/setCurrentProjectTargets",t)}}},created:function(){},methods:{handleOpenTargetDialog:function(){this.$emit("showTargetFromDialog")},checkTargetOndate:function(t){var e=Date.now();return e<t.deadline_timestamp},checkTargetSelect:function(t){var e=this.target;return!!e&&e.target_id===t.target_id},chooseTarget:function(t){var e=this;h.a.start();var s=this.selectedTask,a=s.target_id===t?null:t;Object(d["s"])(s.task_id,{target_id:a}).then((function(t){var s=t.data;e.selectedTask=s})).finally((function(){h.a.done()}))}}}),g=f,k=(s("63f2"),s("2877")),_=Object(k["a"])(g,m,p,!1,null,"7588d72f",null),v=_.exports,b=s("c570"),C=s("2062"),y={name:"TaskBar",components:{UserBlock:o["a"],UserTagPopover:l["a"],TargetListSelect:v,TargetFormDialog:b["a"],UserAvatar:c["a"]},data:function(){return{activeName1:["1","2","3","4"],dialogActivity:{},showActivityDialog:!1,noMore:!1,loading:!1,page:1,activities:[],optionalDate:{format:C["b"]}}},computed:{task:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},user:function(){var t=this.task;return t?t.user:null},ref_users:function(){var t=this.task;return t?t.ref_users:null},disabled:function(){return this.loading||this.noMore}},watch:{task:function(){this.loadActivity()}},created:function(){this.loadActivity()},methods:{load:function(){this.noMore||(this.page++,this.loadActivity())},loadActivity:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading=!0,s=t.page,a=t.task,!a){e.next=5;break}return e.next=5,Object(d["o"])(a.task_id,{page:s}).then((function(e){var s=e.data;t.loading=!1,s.current_page===s.last_page&&(t.noMore=!0),t.activities=Object(n["a"])(s.data)})).catch((function(t){console.log(t)}));case 5:case"end":return e.stop()}}),e)})))()},handleShowDialog:function(t){this.showActivityDialog=!0,this.dialogActivity=t},handleChange:function(t){},handleOpenTargetFormDialog:function(){this.$refs.target_form_dialog.showDialog()},handleChooseUser:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.task,a=s.ref_ids,i=s.task_id,n=t.user_id;a=a||[];var r=a.indexOf(n);if(r>=0){if(!e)return this.$message.warning("Tài khoản đã được thêm");a.splice(r,1),console.log(a),this.handleUpdateTask(i,a)}else a.push(n),this.handleUpdateTask(i,a)},handleUpdateTask:function(t,e){var s=this;h.a.start(),Object(d["s"])(t,{ref_ids:e}).then((function(t){var e=t.data;s.task=e,s.$message.success("Thành công")})).finally((function(){h.a.done()}))}}},w=y,T=(s("3938"),s("0d02"),Object(k["a"])(w,a,i,!1,null,"2f151ea2",null));e["a"]=T.exports},"7a16":function(t,e,s){},"7ad0":function(t,e,s){},"7f6d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.task?s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadding,expression:"loadding"}],staticClass:"task-detail custom-scroll"},[s("div",{staticClass:"box"},[s("div",{staticClass:"task-header"},[s("span",{staticClass:"task-name",style:t.is_edit?"--width:50%":"--width: auto"},[t._v(" "+t._s(t.task.edit)+" "),t.is_edit?[s("el-input",{staticClass:"edit-input",attrs:{size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.cancelEdit(e)}},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}},[t._v("> "),s("el-button",{attrs:{slot:"append",icon:"el-icon-check"},on:{click:function(e){return e.stopPropagation(),t.cancelEdit(e)}},slot:"append"})],1)]:s("a",{on:{click:function(e){t.is_edit=!0}}},[t._v(t._s(t.task.name))])],2),s("span",{staticClass:"task-project"},[t._v(t._s(t.projectName))]),t.isTrello?s("div",{staticClass:"task-header__bar",on:{click:t.showDrawerTaskBar}},[t._v(" Xem chi tiết công việc ")]):t._e(),s("drawer-task-bar",{ref:"drawerTaskBar"})],1),s("div",{staticClass:"task-info"},[s("el-tooltip",{attrs:{content:"Tình trạng",placement:"top",effect:"light"}},[s("task-state",{attrs:{task:t.task},on:{"update:task":function(e){t.task=e}}})],1),s("el-tooltip",{attrs:{content:"Độ ưu tiên",placement:"top",effect:"light"}},[s("set-task-priority",{attrs:{task:t.task},on:{"update:task":function(e){t.task=e}}})],1),t.task.extend_state?s("span",{staticClass:"state",class:"state-"+t.task.extend_state,staticStyle:{"padding-right":"5px"}},[t._v(t._s(t.getStateTextById(t.task.extend_state)))]):t._e(),t._l(t.task.tags,(function(e){return s("span",{key:e.task_tag_id,staticClass:"tag priority",style:{color:e.color.color,backgroundColor:e.color.background_color}},[t._v(t._s(e.name))])})),s("el-popover",{attrs:{placement:"bottom",trigger:"click","popper-class":"tag-popover no-padding"}},[s("tag",{on:{openCreateTag:t.handleOpenCreateTag}}),s("span",{staticClass:"add-tag priority",attrs:{slot:"reference"},slot:"reference"},[t._v("Thêm nhãn")])],1)],2),s("div",{staticClass:"assign-info"},[s("div",[s("span",{staticClass:"item set-assignee",on:{click:t.handleOpenAssigneeDialog}},[t.task.assignee?s("p",[s("user-avatar",{attrs:{user:t.task.assignee,width:20,"font-size":10,"line-height":20,"border-radius":50}}),s("span",{staticClass:"assignee-name"},[t._v(t._s(t.task.assignee.name))])],1):s("p",[s("avatar-tooltip",{attrs:{name:""}}),t._v(" "),s("span",[t._v(" Giao cho ")])],1)]),s("span",{staticClass:"item due-date"},[s("i",{staticClass:"el-icon-info"}),t._v(" Ngày bắt đầu: "),s("i",{domProps:{textContent:t._s(t.formatDate(t.task.deadline_from,t.optionalDate("Chọn ngày bắt đầu")))},on:{click:function(e){return t.handleOpenDeadlineDialog("from")}}}),t._v(" - Ngày kết thúc: "),s("i",{domProps:{textContent:t._s(t.formatDate(t.task.deadline_to,t.optionalDate("Chọn ngày kết thúc")))},on:{click:function(e){return t.handleOpenDeadlineDialog("to")}}})]),s("span",{staticClass:"item time"},[t._v(" Thời gian định mức: "),s("i",{on:{click:t.handleOpenDurationDialog}},[t._v(t._s(t.task.duration?t.task.duration+"h":"Chọn định mức"))])])]),s("div",{staticClass:"remove",attrs:{title:"Xóa công việc"},on:{click:t.taskRemove}},[s("i",{staticClass:"far fa-trash-alt"})])]),s("sub-task-input",{attrs:{"task-id":t.task.task_id,"task-group-id":t.task.task_group_id,"is-trello":t.isTrello},on:{pushSubTask:t.pushSubTask}}),s("div",{staticClass:"subtask-list"},t._l(t.task.sub_tasks,(function(e){return s("sub-task-item",{key:e.task_id+Math.random().toString(36).substring(2,15),attrs:{task:e,"is-trello":t.isTrello}})})),1)],1),s("description"),s("task-result"),s("task-comment",{attrs:{task:t.task,comments:t.task.comments,"total-comment":t.task.total_comment},on:{"update:task":function(e){t.task=e},"update:comments":function(e){return t.$set(t.task,"comments",e)},"update:totalComment":function(e){return t.$set(t.task,"total_comment",e)},"update:total-comment":function(e){return t.$set(t.task,"total_comment",e)}}}),s("create-tag-dialog",{ref:"create_tag"}),s("deadline-dialog",{ref:"deadline_dialog"}),s("deadline-dialog",{ref:"deadline_to_dialog",attrs:{type:"date",title:"Ngày kết thúc"}}),s("duration-dialog",{ref:"duration_dialog"}),s("dialog-assignee",{ref:"dialog_assignee",attrs:{"task-id":t.task.task_id},on:{"update:taskId":function(e){return t.$set(t.task,"task_id",e)},"update:task-id":function(e){return t.$set(t.task,"task_id",e)}}})],1):t._e()},i=[],n=s("53ca"),r=(s("a9e3"),s("b0c0"),s("c740"),s("7db0"),s("d81d"),s("cc1d")),o=s("a18d"),c=s("b199"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"subtask"},[s("div",{staticClass:"input"},[s("el-input",{attrs:{placeholder:"NHẬP TÊN CÔNG VIỆC CON MỚI, ENTER ĐỂ THÊM"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateSubTask(e)}},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[s("template",{slot:"prepend"},[s("svg-icon",{attrs:{"icon-class":"plus"}})],1)],2)],1),s("div",{staticClass:"optional"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",placeholder:"Ngày bắt đầu - Ngày kết thúc",format:"dd-MM-yyyy","value-format":"timestamp","start-placeholder":"Ngày bắt đầu","end-placeholder":"Ngày kết thúc","picker-options":t.pickerOptions},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateSubTask(e)}},model:{value:t.deadline,callback:function(e){t.deadline=e},expression:"deadline"}})],1),s("el-col",{attrs:{span:8}},[s("el-input",{attrs:{type:"number",min:"0",placeholder:"Thời gian cho phép(giờ)"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateSubTask(e)}},model:{value:t.duration,callback:function(e){t.duration=e},expression:"duration"}},[s("i",{attrs:{slot:"prefix"},slot:"prefix"},[s("svg-icon",{attrs:{"icon-class":"timelapse"}})],1)])],1),s("el-col",{attrs:{span:8}},[s("el-input",{attrs:{placeholder:"Giao cho"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateSubTask(e)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[s("i",{attrs:{slot:"prefix"},slot:"prefix"},[s("svg-icon",{attrs:{"icon-class":"account_circle"}})],1)]),s("auto-complete-user-tag",{attrs:{keyword:t.keywordAuto},on:{"update:keyword":function(e){t.keywordAuto=e},afterSellect:t.handleSetAssignee}})],1)],1)],1),s("deadline-dialog",{ref:"deadline_dialog"})],1)},d=[],u=(s("498a"),s("d3b7"),s("323e")),h=s.n(u),m=s("f0d0"),p=s("02d1"),f={name:"SubTaskInput",components:{AutoCompleteUserTag:m["a"],DeadlineDialog:p["a"]},props:{taskId:{type:Number,default:0},taskGroupId:{type:Number,default:0},isTrello:{type:Boolean,default:!1}},data:function(){return{name:"",deadline:null,duration:null,assignee_id:null,keyword:"",pickerOptions:{disabledDate:function(t){var e=new Date;return e.setDate(e.getDate()-1),t.getTime()<e}}}},computed:{keywordAuto:function(){var t=this.keyword;return t=t?t.trim():"",t.indexOf("@")>=0?"":t},taskByGroups:{get:function(){return this.$store.getters["taskGroup/list"]},set:function(t){this.$store.commit("taskGroup/SET_TASK_GROUPS",t)}},project:{get:function(){return this.$store.getters.selectedProject}},user:function(){return this.$store.getters["user/profile"]}},watch:{taskId:function(){this.keyword=null,this.assignee_id=null}},methods:{resetData:function(){this.name="",this.deadline=null,this.duration=null,this.assignee_id=null,this.keyword=null},handleCreateSubTask:function(){var t=this,e=this.deadline?this.deadline[0]:"",s=this.deadline?this.deadline[1]:"";this.name?Object(c["c"])({name:this.name.trim(),deadline_from:e,deadline_to:s,duration:this.duration,assignee_id:this.assignee_id,parent_id:this.taskId}).then((function(e){var s=e.data;if(!t.isTrello){var a=t.taskByGroups.findIndex((function(e){return e.task_group_id===t.taskGroupId})),i=t.taskByGroups[a].tasks.findIndex((function(e){return e.task_id===t.taskId})),n=Object.assign([],t.taskByGroups[a].tasks[i].sub_tasks);n.unshift(s),t.taskByGroups[a].tasks[i].sub_tasks=n}t.$emit("pushSubTask",s),t.$store.dispatch("report/fetchReport",{projectId:t.$route.params.projectId}),t.resetData(),t.$message.success("Tạo mới thành công")})).finally((function(){h.a.done()})):this.$message.error("Vui lòng không để trống tên công việc con!")},handleSetAssignee:function(t){this.assignee_id=t.user_id,this.keyword="@"+t.name},chooseDateRange:function(){this.$refs.deadline_dialog.showDialog()}}},g=f,k=(s("72dd"),s("6436"),s("2877")),_=Object(k["a"])(g,l,d,!1,null,"72d3b2ce",null),v=_.exports,b=s("c445"),C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box box-description"},[s("h3",{staticClass:"box-header"},[t._v(" Mô tả công việc "),s("span",{staticClass:"edit-description",on:{click:function(e){return t.setIsEdit(!0)}}},[s("svg-icon",{attrs:{"icon-class":"pencil"}})],1),s("span",{staticClass:"add-checklist"},[s("a",{on:{click:t.handleOpenChecklistGroupDialog}},[t._v("Thêm Checklist")])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}],domProps:{innerHTML:t._s(t.content)}}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"input"},[s("tinymce",{ref:"tinymce",attrs:{menubar:"",height:"150",plugins:t.plugins},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),s("div",{staticClass:"action"},[s("span",{staticClass:"close"},[s("svg-icon",{attrs:{"icon-class":"close_gray"},on:{click:function(e){return t.setIsEdit(!1)}}})],1),s("span",{staticClass:"send"},[s("svg-icon",{attrs:{"icon-class":"send_blue"},on:{click:t.updateDescription}})],1)])],1),s("attachment"),s("check-list"),s("check-list-group-dialog",{ref:"check_list_group_dialog"})],1)},y=[],w=(s("a4d3"),s("e01a"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tinymce-container",class:{fullscreen:t.fullscreen},style:{width:t.containerWidth}},[s("textarea",{staticClass:"tinymce-textarea",attrs:{id:t.tinymceId}}),t._v(" "),s("div",{staticClass:"editor-custom-btn-container"},[s("editorImage",{staticClass:"editor-upload-btn",attrs:{color:"#1890ff"},on:{successCBK:t.imageSuccessCBK}})],1)])}),T=[],D=(s("b680"),s("159b"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"upload-container"},[s("el-button",{style:{background:t.color,borderColor:t.color},attrs:{icon:"el-icon-upload",size:"mini",type:"primary"},on:{click:function(e){t.dialogVisible=!0}}}),s("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-upload",{staticClass:"editor-slide-upload",attrs:{multiple:!0,"file-list":t.fileList,"show-file-list":!0,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"before-upload":t.beforeUpload,action:"https://httpbin.org/post","list-type":"picture-card"}},[s("el-button",{attrs:{size:"small",type:"primary"}},[t._v(" Click upload ")])],1),s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v(" Cancel ")]),s("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v(" Confirm ")])],1)],1)}),j=[],x=(s("b64b"),s("3ca3"),s("ddb0"),s("2b3d"),s("9861"),{name:"EditorSlideUpload",props:{color:{type:String,default:"#1890ff"}},data:function(){return{dialogVisible:!1,listObj:{},fileList:[]}},methods:{checkAllSuccess:function(){var t=this;return Object.keys(this.listObj).every((function(e){return t.listObj[e].hasSuccess}))},handleSubmit:function(){var t=this,e=Object.keys(this.listObj).map((function(e){return t.listObj[e]}));this.checkAllSuccess()?(this.$emit("successCBK",e),this.listObj={},this.fileList=[],this.dialogVisible=!1):this.$message("Please wait for all images to be uploaded successfully. If there is a network problem, please refresh the page and upload again!")},handleSuccess:function(t,e){for(var s=e.uid,a=Object.keys(this.listObj),i=0,n=a.length;i<n;i++)if(this.listObj[a[i]].uid===s)return this.listObj[a[i]].url=t.files.file,void(this.listObj[a[i]].hasSuccess=!0)},handleRemove:function(t){for(var e=t.uid,s=Object.keys(this.listObj),a=0,i=s.length;a<i;a++)if(this.listObj[s[a]].uid===e)return void delete this.listObj[s[a]]},beforeUpload:function(t){var e=this,s=window.URL||window.webkitURL,a=t.uid;return this.listObj[a]={},new Promise((function(i,n){var r=new Image;r.src=s.createObjectURL(t),r.onload=function(){e.listObj[a]={hasSuccess:!1,uid:t.uid,width:this.width,height:this.height}},i(!0)}))}}}),A=x,$=(s("8f7f"),Object(k["a"])(A,D,j,!1,null,"234fb65a",null)),S=$.exports,I=["searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"],O=I,E=s("b85c"),B=[];function F(){return window.tinymce}var P=function(t,e){var s=document.getElementById(t),a=e||function(){};if(!s){var i=document.createElement("script");i.src=t,i.id=t,document.body.appendChild(i),B.push(a);var n="onload"in i?r:o;n(i)}function r(e){e.onload=function(){this.onerror=this.onload=null;var t,s=Object(E["a"])(B);try{for(s.s();!(t=s.n()).done;){var a=t.value;a(null,e)}}catch(i){s.e(i)}finally{s.f()}B=null},e.onerror=function(){this.onerror=this.onload=null,a(new Error("Failed to load "+t),e)}}function o(t){t.onreadystatechange=function(){if("complete"===this.readyState||"loaded"===this.readyState){this.onreadystatechange=null;var e,s=Object(E["a"])(B);try{for(s.s();!(e=s.n()).done;){var a=e.value;a(null,t)}}catch(i){s.e(i)}finally{s.f()}B=null}}}s&&a&&(F()?a(null,s):B.push(a))},M=P,L="https://cdn.jsdelivr.net/npm/tinymce-all-in-one@4.9.3/tinymce.min.js",R={name:"Tinymce",components:{editorImage:S},props:{id:{type:String,default:function(){return"vue-tinymce-"+ +new Date+(1e3*Math.random()).toFixed(0)}},value:{type:String,default:""},toolbar:{type:Array,required:!1,default:function(){return[]}},menubar:{type:String,default:"file edit insert view format table"},plugins:{type:Array,default:["advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"]},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"}},data:function(){return{hasChange:!1,hasInit:!1,tinymceId:this.id,fullscreen:!1,languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"}}},computed:{containerWidth:function(){var t=this.width;return/^[\d]+(\.[\d]+)?$/.test(t)?"".concat(t,"px"):t}},watch:{value:function(t){var e=this;!this.hasChange&&this.hasInit&&this.$nextTick((function(){window.tinymce.get(e.tinymceId)&&window.tinymce.get(e.tinymceId).setContent(t||"")}))}},mounted:function(){this.init()},activated:function(){window.tinymce&&this.initTinymce()},deactivated:function(){this.destroyTinymce()},destroyed:function(){this.destroyTinymce()},methods:{init:function(){var t=this;M(L,(function(e){e?t.$message.error(e.message):t.initTinymce()}))},initTinymce:function(){var t=this,e=this;window.tinymce.init({selector:"#".concat(this.tinymceId),language:this.languageTypeList["en"],height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:O,menubar:this.menubar,plugins:this.plugins,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:this.height,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,content_style:"body {font-size: 12px;text-rendering: optimizeLegibility; font-family: roboto, Helvetica Neue, Helvetica,PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif;color: #232323;}",init_instance_callback:function(s){e.value&&s.setContent(e.value),e.hasInit=!0,s.on("NodeChange Change KeyUp SetContent",(function(){t.hasChange=!0,t.$emit("input",s.getContent())}))},setup:function(t){t.on("FullscreenStateChanged",(function(t){e.fullscreen=t.state}))},convert_urls:!1})},destroyTinymce:function(){if(window.tinymce){var t=window.tinymce.get(this.tinymceId);this.fullscreen&&t.execCommand("mceFullScreen"),t&&t.destroy()}},setContent:function(t){window.tinymce&&this.initTinymce(),window.tinymce.get(this.tinymceId).setContent(t)},getContent:function(){window.tinymce.get(this.tinymceId).getContent()},imageSuccessCBK:function(t){var e=this;t.forEach((function(t){return window.tinymce.get(e.tinymceId).insertContent('<img class="wscnph" src="'.concat(t.url,'" >'))}))}}},U=R,N=(s("2e25"),Object(k["a"])(U,w,T,!1,null,"184f640a",null)),G=N.exports,V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:(t.checkListGroup?"Cập nhật":"Thêm mới")+" checklist",visible:t.dialogFormVisible,width:"600px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-position":"top","label-width":"130px",rules:t.rules,size:"small"}},[s("el-form-item",{attrs:{label:"Tên checklist",prop:"name"}},[s("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v("Xác nhận")])],1)],1)},J=[],z=(s("2a68"),{name:"CheckListGroupDialog",props:{checkListGroup:{type:Object,default:function(){}}},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,formData:{name:this.checkListGroup?this.checkListGroup.name:""},rules:{name:[{required:!0,message:"Chưa nhập tên checklist",trigger:"change"}]}}},created:function(){},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId},selectedCheckListGroups:{get:function(){return this.$store.getters.selectedCheckListGroups},set:function(t){this.$store.dispatch("task/setSelectedCheckListGroups",t)}}},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},resetFormData:function(){this.formData=defaultFormData,this.$refs["dataForm"].resetFields()},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formData,a=t.selectedTaskId,i=t.selectedCheckListGroups,n=t.checkListGroup,r=n&&n.task_check_list_group_id?n.task_check_list_group_id:null;r&&(s.task_check_list_group_id=r),Object(c["b"])(a,s).then((function(e){var a=e.data;t.loading=!1,r?(n.name=s.name,t.$store.dispatch("task/updateSelectedCheckListGroups",n)):(i.push(a),t.selectedCheckListGroups=i),t.formData.name="",t.$message({type:"success",message:"Thành công"}),t.hideDialog(),t.resetFormData()})).finally((function(){t.loadingBtn=!1}))}}))}}}),Q=z,Y=Object(k["a"])(Q,V,J,!1,null,"1f3d9745",null),K=Y.exports,H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.selectedCheckListGroups&&t.selectedCheckListGroups.length?s("div",{staticClass:"box box-checklist"},[s("h3",{staticClass:"box-header border"},[t._v("Danh sách cần kiểm tra")]),s("div",{staticClass:"checklist-wrapper"},[s("el-collapse",{model:{value:t.checklistGroup,callback:function(e){t.checklistGroup=e},expression:"checklistGroup"}},t._l(t.selectedCheckListGroups,(function(t,e){return s("check-list-group",{key:t.task_check_list_group_id,attrs:{"check-list-group":t,index:e}})})),1)],1)]):t._e()},X=[],W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-collapse-item",{attrs:{disabled:t.disabled,title:t.checkListGroup.name,name:t.index}},[s("template",{slot:"title"},[s("span",{staticClass:"title"},[t._v(t._s(t.checkListGroup.name))]),s("span",{staticClass:"action"},[s("span",{staticClass:"edit"},[s("svg-icon",{attrs:{"icon-class":"pencil"},on:{click:t.handleOpenCheckListDialog}})],1),s("span",{staticClass:"delete",on:{click:t.handleDeleteCheckList}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1)])]),s("check-list-input",{attrs:{checkListGroup:t.checkListGroup}}),s("div",{staticClass:"check-list-wrapper"},t._l(t.checkListGroup.checklists,(function(e,a){return s("check-list-item",{key:e.task_check_list_id,attrs:{index:a,checklist:e,checkListGroup:t.checkListGroup}})})),1)],2),s("check-list-group-dialog",{ref:"check_list_group_dialog",attrs:{checkListGroup:t.checkListGroup}})],1)},q=[],Z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.checklist?s("div",{staticClass:"subtask-item check-list-item"},[s("span",{staticClass:"set-status"},[s("el-checkbox",{attrs:{checked:t.checklistStatus},on:{change:t.handleChangeStatus}})],1),s("div",{staticClass:"checklist-header"},[s("span",{staticClass:"checklist-name"},[s("a",[t._v(t._s(t.checklist.name))])]),s("span",{staticClass:"info"},[s("span",{staticClass:"edit action-item",on:{click:t.handleOpenCheckListDialog}},[s("svg-icon",{attrs:{"icon-class":"pencil"}})],1),s("span",{staticClass:"delete action-item",on:{click:t.handleDeleteCheckList}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1),s("span",{staticClass:"assignee",on:{click:t.handleOpenAssigneeDialog}},[t.checklist.assignee?s("user-avatar",{attrs:{user:t.checklist.assignee,width:18,fontSize:11,lineHeight:18,borderRadius:50}}):s("svg-icon",{attrs:{"icon-class":"user"}})],1),s("span",{staticClass:"created_at"},[t._v(t._s(t.checklist.created_at))])])]),s("check-list-dialog",{ref:"check_list_dialog",attrs:{checklist:t.checklist,index:t.index},on:{updateView:t.handleReactivityCheckListInView}}),s("dialog-assignee",{ref:"dialog_assignee",attrs:{isAll:!1,taskId:t.selectedTaskId,checkListId:t.checklist.task_check_list_id},on:{"update:checkListId":function(e){return t.$set(t.checklist,"task_check_list_id",e)},"update:check-list-id":function(e){return t.$set(t.checklist,"task_check_list_id",e)},updateView:t.handleReactivityCheckListInView}})],1):t._e()},tt=[],et=(s("a434"),s("857d")),st=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"Chỉnh sửa",visible:t.dialogFormVisible,width:"600px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-position":"top","label-width":"130px",rules:t.rules,size:"small"}},[s("el-form-item",{attrs:{label:"Phải làm",prop:"name"}},[s("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v("Xác nhận")])],1)],1)},at=[],it={name:"CheckListGroupDialog",props:{checklist:{type:Object,default:function(){}}},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,formData:{name:this.checklist.name},rules:{name:[{required:!0,message:"Chưa nhập nội dung",trigger:"change"}]}}},created:function(){},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId}},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},resetFormData:function(){this.formData=defaultFormData,this.$refs["dataForm"].resetFields()},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formData,a=t.selectedTaskId,i=t.checklist;Object(c["a"])(a,{task_check_list_id:i.task_check_list_id,name:s.name,task_check_list_group_id:i.task_check_list_group_id}).then((function(e){var s=e.data;t.loading=!1,t.$emit("updateView",s),t.$message({type:"success",message:"Thành công"}),t.hideDialog()})).finally((function(){t.loadingBtn=!1}))}}))}}},nt=it,rt=Object(k["a"])(nt,st,at,!1,null,"0dd44bdc",null),ot=rt.exports,ct=s("941b"),lt=s("3b86"),dt={name:"CheckListItem",props:{checklist:{type:Object,default:function(){}},checkListGroup:{type:Object,default:function(){}},index:{type:Number,default:0}},components:{SetTaskStateCheck:et["a"],CheckListDialog:ot,DialogAssignee:ct["a"],UserAvatar:lt["a"]},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId},checklistStatus:function(){var t=this.checklist;if(t)return!!t.status}},methods:{handleChangeStatus:function(t){var e=this,s=this.selectedTaskId,a=this.checklist,i=a.task_check_list_id;Object(c["q"])(s,{task_check_list_id:i,status:t?1:0}).then((function(t){return e.$message.success("Thành công")}))},handleOpenAssigneeDialog:function(){this.$refs.dialog_assignee.showDialog()},handleOpenCheckListDialog:function(){this.$refs.check_list_dialog.showDialog()},handleDeleteCheckList:function(){var t=this,e=this.selectedTaskId,s=this.checklist;this.checkListGroup;this.$confirm("Xác nhận xóa công việc?","Warning",{confirmButtonText:"Xác nhận",cancelButtonText:"Đóng",type:"warning"}).then((function(){h.a.start(),Object(c["f"])(e,{task_check_list_id:s.task_check_list_id}).then((function(e){t.index;t.handleReactivityCheckListInView(),t.$message.success("Xóa checklist thành công")})).finally((function(){h.a.done()}))})).catch((function(t){console.error(t)}))},handleReactivityCheckListInView:function(t){var e=this.checkListGroup,s=this.index;console.log(s,e,t),e&&(t?(e.checklists[s].name=t.name,e.checklists[s].assignee=t.assignee):e.checklists.splice(s,1),console.log(e),this.$store.dispatch("task/updateSelectedCheckListGroups",e))}}},ut=dt,ht=(s("0964"),Object(k["a"])(ut,Z,tt,!1,null,"3676baaa",null)),mt=ht.exports,pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"check-list-input"},[s("el-input",{attrs:{placeholder:"Tạo công việc, enter để gửi"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateCheckList(e)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[s("i",{attrs:{slot:"prefix"},slot:"prefix"},[s("svg-icon",{attrs:{"icon-class":"add"}})],1)])],1)},ft=[],gt={name:"CheckListInput",props:{checkListGroup:{type:Object,default:function(){}}},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId}},data:function(){return{value:""}},methods:{handleCreateCheckList:function(){var t=this,e=this.selectedTaskId,s=this.checkListGroup,a=this.value;a=a.trim(),a&&(h.a.start(),Object(c["a"])(e,{task_check_list_group_id:s.task_check_list_group_id,name:a}).then((function(e){var a=e.data;s.checklists.unshift(a),t.value="",t.$message.success("Thành công")})).finally((function(){h.a.done()})))}}},kt=gt,_t=(s("2296"),Object(k["a"])(kt,pt,ft,!1,null,null,null)),vt=_t.exports,bt={name:"CheckListGroup",components:{CheckListItem:mt,CheckListInput:vt,CheckListGroupDialog:K},props:{checkListGroup:{type:Object,default:function(){}},index:{type:Number,default:0}},data:function(){return{disabled:!1}},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId}},methods:{disableCollapse:function(){var t=this;this.disabled=!0,setTimeout((function(){t.disabled=!1}),500)},handleOpenCheckListDialog:function(){this.disableCollapse(),this.$refs.check_list_group_dialog.showDialog()},handleDeleteCheckList:function(){var t=this;this.disableCollapse();var e=this.checkListGroup,s=this.selectedTaskId;e&&this.$confirm("Xóa checklist sẽ xóa hết các công việc con?","Warning",{confirmButtonText:"Xác nhận",cancelButtonText:"Đóng",type:"warning"}).then((function(){h.a.start(),Object(c["g"])(s,{task_check_list_group_id:e.task_check_list_group_id}).then((function(s){e.is_delete=!0,t.$store.dispatch("task/updateSelectedCheckListGroups",e),t.$message.success("Xóa checklist thành công")})).finally((function(){h.a.done()}))})).catch((function(t){console.error(t)}))}}},Ct=bt,yt=(s("0da0"),s("dd05"),Object(k["a"])(Ct,W,q,!1,null,"f9455006",null)),wt=yt.exports,Tt={name:"ChecklistIndex",components:{CheckListGroup:wt},props:{},data:function(){return{checklistGroup:[]}},computed:{selectedCheckListGroups:{get:function(){return this.$store.getters.selectedCheckListGroups},set:function(t){this.$store.dispatch("task/setSelectedCheckListGrops",t)}}},created:function(){var t=[],e=this.selectedCheckListGroups;if(e)for(var s=0;s<e.length;s++)t.push(s),this.checklistGroup=t},methods:{}},Dt=Tt,jt=(s("509a"),Object(k["a"])(Dt,H,X,!1,null,"103f5b9b",null)),xt=jt.exports,At=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h3",{staticClass:"box-header border"},[t._v(" Tài liệu đính kèm "),s("span",{staticClass:"icon add-attachment",on:{click:function(e){return t.$refs.file.click()}}},[s("svg-icon",{attrs:{"icon-class":"outbox"}})],1)]),s("div",{staticClass:"input"},[s("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*, .doc, .docx, .xls, .xlsx, .pdf"},on:{change:t.handleUpload}}),t.attachments?s("div",{staticClass:"attachment-list"},[s("div",{staticClass:"image"},t._l(t.attachments,(function(e){return s("attachment-image",{directives:[{name:"show",rawName:"v-show",value:e.is_image,expression:"attachment.is_image"}],key:e.file_name,attrs:{attachment:e,"remove-attachment":t.removeAttachment}})})),1),s("div",{staticClass:"file"},t._l(t.attachments,(function(e){return s("attachment-file",{directives:[{name:"show",rawName:"v-show",value:!e.is_image,expression:"!attachment.is_image"}],key:e.file_name,attrs:{attachment:e,"remove-attachment":t.removeAttachment}})})),1)]):s("div",{staticClass:"no-attachment"},[s("span",{staticClass:"icon pr-5"},[s("svg-icon",{attrs:{"icon-class":"block"}})],1),s("span",[t._v("Không có tài liệu đính kèm")])])])])},$t=[],St=2,It=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"attachment-item",on:{click:function(e){t.dialogVisible=!0}}},[s("el-image",{staticStyle:{width:"130px"},attrs:{src:t.attachment.full_url,"preview-src-list":[t.attachment.full_url]}}),s("span",{staticClass:"action"},[s("span",{staticClass:"download"},[s("a",{attrs:{href:t.attachment.full_url,target:"_blank",download:""}},[s("svg-icon",{attrs:{"icon-class":"download"}})],1)]),s("span",{staticClass:"remove",on:{click:function(e){return t.removeAttachment(t.attachment.attachment_id)}}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1)])],1)},Ot=[],Et={name:"AttachmentImage",props:{attachment:{type:Object,default:function(){}},removeAttachment:{type:Function,default:function(){}}},data:function(){return{}},methods:{}},Bt=Et,Ft=(s("d262"),Object(k["a"])(Bt,It,Ot,!1,null,"6c0f348a",null)),Pt=Ft.exports,Mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"attachment-item"},[s("a",{attrs:{href:t.attachment.full_url,target:"_blank",download:""}},[s("svg-icon",{attrs:{"icon-class":"clip"}}),t._v(" "+t._s(t.attachment.original_file_name)+" ")],1),s("span",{staticClass:"action"},[s("span",{staticClass:"download"},[s("a",{attrs:{href:t.attachment.full_url,target:"_blank",download:""}},[s("svg-icon",{attrs:{"icon-class":"download"}})],1)]),s("span",{staticClass:"remove",on:{click:function(e){return t.removeAttachment(t.attachment.attachment_id)}}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1)])])},Lt=[],Rt={name:"AttachmentFile",props:{attachment:{type:Object,default:function(){}},removeAttachment:{type:Function,default:function(){}}},methods:{}},Ut=Rt,Nt=(s("fdf6"),Object(k["a"])(Ut,Mt,Lt,!1,null,"d7f291d0",null)),Gt=Nt.exports,Vt={name:"TaskAttachment",components:{AttachmentImage:Pt,AttachmentFile:Gt},props:{},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},attachments:function(){return this.selectedTask?this.selectedTask.attachments:{}}},methods:{removeAttachment:function(t){var e=this,s=this.selectedTask,a=s.attachment_ids,i=a.indexOf(t);i>=0&&(a.splice(i,1),h.a.start(),Object(c["s"])(s.task_id,{attachment_ids:a}).then((function(t){var s=t.data;e.selectedTask=s})).finally((function(){h.a.done()})))},handleUpload:function(t){var e=this;if(t.target.files&&t.target.files[0]){var s=/\.(gif|jpe?g|png|webp|bmp|doc|docx|xls|xlsx|pdf)$/i,a=t.target.files[0];if(a.size>1024*St*1024)return this.$message.error("Dung lượng file không được quá : ".concat(St,"MB"));if(!s.test(a.name))return this.$message.error("Bạn chỉ có thể gửi ảnh hoặc các file có định dạng pdf, doc, xls");var i=this.selectedTask;if(i){h.a.start();var n=new FormData;n.append("file",a),Object(c["t"])(i.task_id,n).then((function(t){var s=t.data;e.selectedTask=s})).finally((function(){h.a.done()}))}this.$nextTick((function(){e.$refs.file.value=""}))}}}},Jt=Vt,zt=(s("4636"),Object(k["a"])(Jt,At,$t,!1,null,"6a69b1f6",null)),Qt=zt.exports,Yt={name:"Description",components:{Tinymce:G,CheckListGroupDialog:K,CheckList:xt,Attachment:Qt},props:{},data:function(){return{plugins:[""],isEdit:!1,content:""}},computed:{task:{get:function(){var t=this.$store.getters.selectedTask;return t},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}}},watch:{task:function(t){this.content=t.description,this.$refs.tinymce.hasChange=!1}},mounted:function(){this.content=this.task?this.task.description:""},methods:{handleOpenChecklistGroupDialog:function(){this.$refs.check_list_group_dialog.showDialog()},updateDescription:function(){var t=this,e=this.task;e&&(h.a.start(),Object(c["s"])(e.task_id,{description:this.content}).then((function(e){t.setIsEdit(!1),t.$message.success("Cập nhật mô tả thành công!")})).finally((function(){h.a.done()})))},setIsEdit:function(t){this.isEdit=t}}},Kt=Yt,Ht=(s("6d28"),s("2af7"),Object(k["a"])(Kt,C,y,!1,null,"383bf3ee",null)),Xt=Ht.exports,Wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box box-comment"},[s("h3",{staticClass:"box-header"},[t._v("Bình luận ("+t._s(t.task.comments?t.task.comments.length:0)+")")]),s("div",{staticClass:"input"},[s("user-avatar",{attrs:{user:t.user,width:25,"border-radius":50}}),s("task-comment-box",{attrs:{"task-id":t.taskId},on:{"update:taskId":function(e){t.taskId=e},"update:task-id":function(e){t.taskId=e}}})],1),s("div",{staticClass:"comment-list ww-scroll custom-scroll",staticStyle:{height:"460px"}},t._l(t.commentList,(function(e){return s("task-comment-item-group",{key:e.task_comment_id,attrs:{comment:e,"task-id":t.taskId}})})),1)])},qt=[],Zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment-item-group"},[s("task-comment-item",{attrs:{comment:t.comment},on:{toggleReply:t.toggleShowReply}}),s("div",{staticClass:"child-comments"},[t.totalReadMoreComment>0?s("a",{staticClass:"read-more",on:{click:t.toggleShowMore}},[s("svg-icon",{attrs:{"icon-class":"reply_blue"}}),t._v(" "+t._s(t.showMore?"Ẩn bớt":"Xem thêm")+" "+t._s(t.totalReadMoreComment)+" câu trả lời ")],1):t._e(),s("task-comment-item",{directives:[{name:"show",rawName:"v-show",value:t.lastChildComment&&!t.showMore,expression:"lastChildComment && !showMore"}],attrs:{comment:t.lastChildComment},on:{toggleReply:t.toggleShowReply}}),t._l(t.comment.child_comments,(function(e){return s("task-comment-item",{directives:[{name:"show",rawName:"v-show",value:t.showMore,expression:"showMore"}],key:e.task_comment_id,attrs:{comment:e},on:{toggleReply:t.toggleShowReply}})})),s("task-comment-box",{directives:[{name:"show",rawName:"v-show",value:t.showReply,expression:"showReply"}],ref:"comment_box",attrs:{"task-id":t.taskId,"parent-id":t.comment.task_comment_id},on:{pushNewComment:t.pushNewComment}})],2)],1)},te=[],ee=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment-box-wrapper"},[s("div",{staticClass:"comment-box"},[s("el-input",{ref:"input",attrs:{placeholder:"Viết bình luận, nhấn Enter để gửi"},nativeOn:{keyup:[function(e){return t.checkTag(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleCreateComment(e)}]},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},[s("div",{staticClass:"el-input__icon",attrs:{slot:"suffix"},on:{click:t.uploadFile},slot:"suffix"},[s("i",{staticClass:"fas fa-paperclip cursor-pointer"}),s("input",{ref:"file",attrs:{id:"",type:"file",multiple:"",hidden:""},on:{change:function(e){return t.changeFile(e)}}})])]),s("attachment",{ref:"attachments",attrs:{attachments:t.attachments},on:{removeAttachment:t.removeAttachment}})],1),s("auto-complete-user-tag",{attrs:{keyword:t.keyword},on:{"update:keyword":function(e){t.keyword=e},afterSellect:t.appendUserToInput}})],1)},se=[],ae=(s("ac1f"),s("1276"),s("99af"),s("4de4"),s("a796")),ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"comment-box__attachments",style:"--padding: "+(t.attachments.length>0?"5px":"0")+"; --height:"+(t.isTyping?"32px":"auto")+"; --width-file: "+(t.isTyping?"120px":"100%")+"; --width-item: "+(t.isTyping?"auto":"20%")+"; --width-image: "+(t.isTyping?"120px":"100%")+" ",attrs:{"element-loading-text":"Uploading...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[t._l(t.attachments,(function(e){return s("div",{key:e.attachment_id,staticClass:"comment-box__attachments-item",class:e.is_image?"":"comment-box__attachments-file"},[e.is_image?s("img",{attrs:{src:e.full_url},on:{click:function(s){return t.showImage(e.full_url)}}}):s("a",{attrs:{href:e.full_url}},[s("i",{staticClass:"far fa-file-alt"}),s("div",{staticClass:"name",domProps:{textContent:t._s(e.original_file_name)}})]),t.isTyping?s("div",{staticClass:"close",on:{click:function(s){return t.removeAttachment(e)}}},[s("i",{staticClass:"fas fa-times"})]):t._e()])})),s("el-dialog",{staticStyle:{"text-align":"center"},attrs:{title:"Chi tiết hình ảnh",visible:t.dialogVisible,width:"45%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-image",{attrs:{src:t.imageCurrent}},[s("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[t._v(" Loading"),s("span",{staticClass:"dot"},[t._v("...")])])])],1)],2)},ne=[],re={props:{attachments:{type:Array,default:function(){return[]}},isTyping:{type:Boolean,default:!0}},data:function(){return{loading:!1,dialogVisible:!1,imageCurrent:null}},methods:{removeAttachment:function(t){this.$emit("removeAttachment",t)},showImage:function(t){this.dialogVisible=!this.dialogVisible,this.imageCurrent=t}}},oe=re,ce=Object(k["a"])(oe,ie,ne,!1,null,null,null),le=ce.exports,de=s("2ef0"),ue=s.n(de),he={name:"TaskCommentBox",components:{AutoCompleteUserTag:m["a"],Attachment:le},props:{taskId:{type:Number,default:0},parentId:{type:Number,default:0}},data:function(){return{content:"",keyword:"",attachments:[],tag_users:[]}},computed:{task:function(){return this.$store.getters.selectedTask}},created:function(){this.focusInput()},methods:{checkTag:function(){var t=this.content,e=t.split(" ");if(e.length){var s=e.length-1,a=e[s],i=a.lastIndexOf("@");if(i>=0){var n=a.substr(i+1);this.keyword=n}else this.keyword=""}},appendUserToInput:function(t){var e=this.content,s=e.lastIndexOf("@");e=e.substring(0,s);var a="@["+t.name+"]";this.tag_users.push(t.user_id),e+=a,this.content=e,this.keyword="",this.focusInput()},handleCreateComment:function(){var t=this,e=this.content,s=this.taskId,a=this.parentId;if(e=e.trim(),e){h.a.start();var i=JSON.stringify(ue.a.map(this.attachments,ue.a.property("attachment_id")));this.attachments=[],Object(c["d"])(s,{content:e,parent_id:a,attachment_ids:i,tag_users:JSON.stringify(this.tag_users)}).then((function(e){var s=e.data,a=t.task;0!==s.parent_id?a.comments.map((function(t){return t.task_comment_id===s.parent_id&&("undefined"===typeof t.child_comments&&(t["child_comments"]=[]),t["child_comments"].push(s)),t})):a.comments.unshift(s),t.$store.commit("task/SET_SELECTED_TASK",a),t.content=""})).finally((function(){h.a.done()}))}},focusInput:function(){this.$refs&&this.$refs.input&&this.$refs.input.focus()},uploadFile:function(){this.$refs.file.click()},changeFile:function(t){var e=this,s=this;this.$refs.attachments.loading=!0;var a=t.target.files||t.dataTransfer.files;if(a.length){var i=new FormData;a.forEach((function(t){i.append("file[]",t)})),t.target.value=null,Object(ae["a"])(i).then((function(t){e.attachments=e.attachments.concat(t.data),setTimeout((function(){s.$refs.attachments.loading=!1}),1e3)})).catch((function(){s.$refs.attachments.loading=!1}))}},removeAttachment:function(t){this.attachments=this.attachments.filter((function(e){return e!==t}))}}},me=he,pe=(s("2aa9"),Object(k["a"])(me,ee,se,!1,null,null,null)),fe=pe.exports,ge=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.commentMutated?s("div",{staticClass:"comment-item"},[s("div",{staticClass:"comment-item__avatar"},[s("user-avatar",{attrs:{user:t.commentMutated.user,width:25,"border-radius":50}})],1),s("div",{staticClass:"comment-item__content"},[s("div",{staticClass:"header"},[s("div",{staticClass:"header__content"},[t.commentMutated.user?s("span",{staticClass:"user-name"},[s("a",[t._v(t._s(t.commentMutated.user.name))])]):t._e(),s("span",{staticClass:"time",domProps:{textContent:t._s(t.$moment.duration(t.$moment(t.comment.created_at).diff(t.nowTime)).humanize()+" trước")}})]),s("div",{staticClass:"header__action"},[s("span",{domProps:{textContent:t._s(t.commentMutated.reaction&&t.comment.reaction.length>0?"("+t.comment.reaction.length+")":"")}}),s("span",{staticClass:"reaction p-5",class:{active:t.check},style:t.colorLike,on:{click:t.handleReaction}},[s("i",{staticClass:"far fa-thumbs-up"})]),s("el-dropdown",{on:{command:t.handleCommand}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{icon:"el-icon-delete",disabled:!t.isEnableAction,command:"destroy"}},[t._v("Xóa")])],1)],1)],1)]),s("div",{staticClass:"content"},[s("div",{domProps:{innerHTML:t._s(t.commentContent)}}),s("attachment",{ref:"attachments",attrs:{attachments:t.commentMutated.attachments,"is-typing":!1}})],1)])]):t._e()},ke=[],_e=(s("caad"),s("2532"),s("466d"),s("5319"),{name:"TaskCommentItem",components:{UserAvatar:lt["a"],Attachment:le},props:{comment:{type:Object,default:function(){}}},data:function(){return{check:!0,nowTime:new Date,liked:!1,commentMutated:this.comment}},computed:{user_id:function(){return this.$store.getters.user_id},user:function(){return this.$store.getters["user/profile"]},hasReaction:function(){var t=this.commentMutated,e=this.user_id;if(t){var s=t.reaction?t.reaction:[];return s.includes(e)}return!1},commentContent:function(){var t=this.commentMutated,e=t.content;if(!e)return"";var s=e.match(/(?<=@\[)(.*?)(?=\])/g);return s&&s.forEach((function(t){e=e.replace("@["+t+"]",'<a class="user-tag">@'+t+"</a>")})),e},colorLike:function(){var t="cornflowerblue";return this.liked||(t=""),"color: "+t},isEnableAction:function(){return"SYSTEM_ADMIN"===this.user.role||this.user_id&&this.commentMutated.user&&this.commentMutated.user.user_id===this.user_id}},mounted:function(){var t=this;t.liked=this.commentMutated&&this.commentMutated.reaction&&this.commentMutated.reaction.indexOf(this.user_id)>=0,setInterval((function(){t.nowTime=t.$moment()}),6e4)},created:function(){this.check=this.hasReaction},methods:{toggleReply:function(){this.$emit("toggleReply")},handleReaction:function(){var t=this,e=this.commentMutated,s=e.task_comment_id,a=e.task_id;Object(c["n"])(a,s).then((function(e){t.check=!t.check,t.commentMutated.reaction=Object.assign([],t.commentMutated.reaction);var s=t.commentMutated.reaction.indexOf(t.user_id);return s<0?(t.commentMutated.reaction.push(t.user_id),t.liked=!0):(t.commentMutated.reaction.splice(s,1),t.liked=!1),t.$message.success("Thành công")}))},handleCommand:function(t){"destroy"===t&&confirm("Bạn muốn xóa comment này?")&&this.destroy()},destroy:function(){var t=this,e=this.commentMutated,s=e.task_comment_id,a=e.task_id;Object(c["i"])(a,s).then((function(e){t.commentMutated={}}))}}}),ve=_e,be=(s("8cfb"),s("bf73"),Object(k["a"])(ve,ge,ke,!1,null,"e03e9bc2",null)),Ce=be.exports,ye={name:"TaskCommentItemGroup",components:{TaskCommentBox:fe,TaskCommentItem:Ce},props:{comment:{type:Object,default:function(){}},taskId:{type:Number,default:0}},data:function(){return{showReply:!1,showMore:!1,currentComment:this.comment}},computed:{lastChildComment:function(){var t=this.currentComment.child_comments,e=t?t.length:null;return e?t[e-1]:null},totalReadMoreComment:function(){var t=this.currentComment.child_comments;return t?t.length-2:0}},watch:{comment:function(t){this.currentComment=t}},methods:{toggleShowReply:function(){var t=this;this.showReply=!0,this.showMore=!0,this.$nextTick((function(){t.$refs.comment_box.focusInput()}))},toggleShowMore:function(){this.showMore=!this.showMore},pushNewComment:function(t){this.currentComment.child_comments.push(t)}}},we=ye,Te=(s("06dd"),Object(k["a"])(we,Zt,te,!1,null,null,null)),De=Te.exports,je={name:"TaskComment",components:{UserAvatar:lt["a"],TaskCommentItemGroup:De,TaskCommentBox:fe},props:{comments:{type:Array,default:null}},data:function(){return{commentList:this.comments}},computed:{taskId:function(){var t=this.task;return t?t.task_id:0},userAvatar:function(){return this.$store.getters.avatar},user:function(){return this.$store.getters["user/profile"]},task:function(){return this.$store.getters.selectedTask}},watch:{"task.comments":function(){this.commentList=this.task.comments}}},xe=je,Ae=(s("9fcc"),s("26dc"),Object(k["a"])(xe,Wt,qt,!1,null,"61e497cb",null)),$e=Ae.exports,Se=s("3220"),Ie=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-state task-priority inline"},[s("el-popover",{attrs:{placement:"bottom",width:"120",trigger:"click","popper-class":"custom-popover","visible-arrow":!1},model:{value:t.showList,callback:function(e){t.showList=e},expression:"showList"}},[s("div",{staticClass:"list"},[s("ul",t._l(t.getPriorityList(),(function(e){return s("li",{key:e.value,on:{click:function(s){return t.handleChangePriority(e.value)}}},[s("a",[t._v(t._s(e.title))])])})),0)]),t.priority?s("span",{staticClass:"priority",class:"priority-"+t.priority,attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(t.getPriorityTextById(t.priority))+" "),s("span",{staticClass:"arrow"},[s("svg-icon",{attrs:{"icon-class":"expand_more_gray"}})],1)]):t._e()])],1)},Oe=[],Ee={props:{task:{type:Object,default:function(){}}},data:function(){return{showList:!1}},computed:{priority:{get:function(){var t=this.task;if(t)return t.priority},set:function(t){var e=this.task_id;this.$store.dispatch("task/updateTasks",{task_id:e,key:"priority",value:t})}},task_id:function(){var t=this.task;if(t)return t.task_id}},methods:{getPriorityList:r["r"],getPriorityTextById:r["s"],toggleList:function(){},handleChangePriority:function(t){var e=this,s=this.task_id,a=this.priority;if(a==t)return this.showList=!1;h.a.start(),Object(c["s"])(s,{priority:t}).then((function(s){e.priority=t,e.showList=!1,e.$message.success("Cập nhật thành công")})).finally((function(){h.a.done()}))}}},Be=Ee,Fe=(s("e96a"),Object(k["a"])(Be,Ie,Oe,!1,null,"108043b3",null)),Pe=Fe.exports,Me=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"tag-wrapper"},[s("div",{staticClass:"tag-header"},[s("h3",{staticClass:"custom-title"},[t._v("Chọn nhãn")]),s("span",{staticClass:"add-tag"},[s("svg-icon",{attrs:{"icon-class":"plus"},on:{click:t.openCreateTag}})],1)]),s("div",{staticClass:"tag-list custom-scroll"},t._l(t.tags,(function(e){return s("div",{key:e.task_tag_id,staticClass:"item",class:{active:t.checkTagSelect(e)},on:{click:function(s){return t.chooseTag(e.task_tag_id)}}},[s("span",{staticClass:"box-color",style:{backgroundColor:e.color.color}}),s("span",{staticClass:"tag-name"},[t._v(t._s(e.name))])])})),0)])])},Le=[],Re=(s("9f10"),{name:"TaskTag",components:{},props:{},data:function(){return{}},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},taskId:function(){return this.$store.getters.selectedTaskId},selectedProjectId:{set:function(t){this.$store.dispatch("project/setSelectedProjectId",t)},get:function(){return this.$store.getters.selectedProjectId}},taskTags:function(){return this.selectedTask.tag_ids},tags:{get:function(){return this.$store.getters.task_tags},set:function(t){this.$store.dispatch("share/setTaskTags",t)}}},watch:{taskId:function(t){this.getTagsInProject(!0)}},created:function(){this.getTagsInProject()},methods:{getTagsInProject:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.selectedProjectId,s=this.selectedTask;t&&s.project_id==e||(this.selectedProjectId=s.project_id,this.getTags())},getTags:function(){var t=this,e=this.selectedTask;Object(c["k"])(e.task_id).then((function(e){t.tags=e.data}))},openCreateTag:function(){this.$emit("openCreateTag")},checkTagSelect:function(t){return!!this.taskTags&&this.taskTags.includes(t.task_tag_id)},chooseTag:function(t){var e=this;h.a.start();var s=this.selectedTask;Object(c["r"])(s.task_id,{task_tag_id:t}).then((function(t){var a=t.data;s.tag_ids=a.tag_ids,s.tags=a.tags,e.selectedTask=s})).finally((function(){h.a.done()}))}}}),Ue=Re,Ne=Object(k["a"])(Ue,Me,Le,!1,null,"7550cdf5",null),Ge=Ne.exports,Ve=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"Thêm nhãn mới",visible:t.dialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-position":"top","label-width":"160px",rules:t.rules,size:"small"}},[s("el-form-item",{attrs:{label:"Tên nhãn",prop:"name"}},[s("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),s("color-list",{on:{afterSelect:t.selectColor}})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v("Thêm nhãn")])],1)],1)},Je=[],ze=s("ab4e"),Qe={name:"",task_color_id:1},Ye={name:"CreateTagDialog",components:{ColorList:ze["a"]},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,formData:Qe,rules:{name:[{required:!0,message:"Chưa nhập tên nhãn",trigger:"change"}]}}},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},tags:{get:function(){return this.$store.getters.task_tags},set:function(t){this.$store.dispatch("share/setTaskTags",t)}},users:function(){return this.$store.getters.users}},created:function(){},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},resetFormData:function(){this.$refs["dataForm"]&&this.$refs["dataForm"].resetFields()},selectColor:function(t){this.formData.task_color_id=t},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formData,a=t.selectedTask,i=t.tags;Object(c["e"])(a.task_id,s).then((function(e){var s=e.data,a=s.task,n=s.tag;t.loading=!1,t.selectedTask=a,i.push(n),t.tags=i,t.$message({type:"success",message:"Thành công"}),t.resetFormData(),t.hideDialog()})).finally((function(){t.loadingBtn=!1}))}}))}}},Ke=Ye,He=Object(k["a"])(Ke,Ve,Je,!1,null,"2fcf84b4",null),Xe=He.exports,We=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"Thời gian định mức",visible:t.dialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-position":"top","label-width":"130px",rules:t.rules,size:"small"}},[s("el-form-item",{attrs:{label:"Nhập số giờ",prop:"duration"}},[s("el-input",{attrs:{type:"number"},model:{value:t.formData.duration,callback:function(e){t.$set(t.formData,"duration",e)},expression:"formData.duration"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v("Xác nhận")])],1)],1)},qe=[],Ze={duration:null},ts={name:"DurationDialog",data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,formData:Ze,rules:{duration:[{required:!0,message:"Chưa nhập thời gian định mức",trigger:"change"}]}}},created:function(){},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}}},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},resetFormData:function(){this.formData=Ze,this.$refs["dataForm"].resetFields()},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formData,a=t.selectedTask;Object(c["s"])(a.task_id,s).then((function(e){var s=e.data;t.loading=!1,t.selectedTask=s,t.resetFormData(),t.$message({type:"success",message:"Thành công"}),t.hideDialog()})).finally((function(){t.loadingBtn=!1}))}}))}}},es=ts,ss=Object(k["a"])(es,We,qe,!1,null,"59e827df",null),as=ss.exports,is=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box box-result"},[s("h3",{staticClass:"box-header"},[t._v(" Kết quả công việc "),s("span",{staticClass:"slider"},[s("span",{staticClass:"percent"},[t._v(t._s(t.percent)+"%")]),s("el-slider",{on:{change:function(e){t.showEdit=!0}},model:{value:t.percent,callback:function(e){t.percent=e},expression:"percent"}})],1)]),s("div",{staticClass:"input"},[t.showEdit?s("div",{staticClass:"form"},[s("el-row",[s("el-col",{staticClass:"form-input",attrs:{span:16}},[s("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"Cập nhật kết quả công việc"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),s("div",{staticClass:"action"},[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.showEdit=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleUpdateResult}},[t._v("LƯU")])],1)],1),s("el-col",{staticClass:"summery",attrs:{span:8}},[s("span",[t._v("Hoàn thành")]),s("h3",[t._v(t._s(t.percent)+"%")]),s("div",[s("PercentSlide",{attrs:{"slide-color":"#198CFF","percent-done":t.percent}})],1)])],1)],1):s("div",{staticClass:"content"},[t.result?s("div",{staticClass:"result-content"},[s("div",{staticClass:"content-text"},[t._v(t._s(t.result.text))]),s("div",{staticClass:"content-file"},t._l(t.result.attachments,(function(e){return s("AttachmentFile",{directives:[{name:"show",rawName:"v-show",value:!e.is_image,expression:"!attachment.is_image"}],key:"result"+e.attachment_id,attrs:{attachment:e,"remove-attachment":t.removeAttachment}})})),1),s("div",{staticClass:"content-image"},t._l(t.result.attachments,(function(e){return s("AttachmentImage",{directives:[{name:"show",rawName:"v-show",value:e.is_image,expression:"attachment.is_image"}],key:"result"+e.attachment_id,attrs:{attachment:e,"remove-attachment":t.removeAttachment}})})),1)]):t._e(),s("a",{on:{click:function(e){t.showEdit=!0}}},[t._v("Cập nhật kết quả công việc")]),s("a",{on:{click:function(e){return t.$refs.file.click()}}},[t._v("Upload file")]),s("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*, .doc, .docx, .xls, .xlsx, .pdf"},on:{change:t.handleUpload}})])])])},ns=[],rs=s("a688"),os={name:"TaskResult",components:{AttachmentImage:Pt,AttachmentFile:Gt,PercentSlide:rs["a"]},data:function(){return{showEdit:!1,content:"",percent:0}},computed:{selectedTask:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},result:function(){var t=this.selectedTask;return t&&t.result||{text:"",percent:0}}},watch:{result:function(t){this.content=t.text,this.percent=t.percent}},methods:{removeAttachment:function(t){var e=this,s=this.selectedTask,a=s.result,i=a.attachment_ids;if(!i)return this.$message.error("Tập đính kèm không tồn tại hoặc đã bị xóa, vui lòng reload lại");var n=i.indexOf(t);n>=0&&(i.splice(n,1),a.attachment_ids=i,h.a.start(),Object(c["s"])(s.task_id,{result:a}).then((function(t){var s=t.data;e.selectedTask=s})).finally((function(){h.a.done()})))},handleUpdateResult:function(){var t=this,e=this.selectedTask,s=this.content,a=this.percent,i={text:s,percent:a};h.a.start(),Object(c["s"])(e.task_id,{result:i}).then((function(e){var s=e.data;t.selectedTask=s})).finally((function(){t.showEdit=!1,h.a.done()}))},handleUpload:function(t){var e=this;if(t.target.files&&t.target.files[0]){var s=/\.(gif|jpe?g|png|webp|bmp|doc|docx|xls|xlsx|pdf)$/i,a=t.target.files[0];if(a.size>1024*St*1024)return this.$message.error("Dung lượng file không được quá : ".concat(St,"MB"));if(!s.test(a.name))return this.$message.error("Bạn chỉ có thể gửi ảnh hoặc các file có định dạng pdf, doc, xls");var i=this.selectedTask;if(i){h.a.start();var n=new FormData;n.append("file",a),n.append("in_result",!0),Object(c["t"])(i.task_id,n).then((function(t){var s=t.data;e.selectedTask=s})).finally((function(){h.a.done()}))}this.$nextTick((function(){e.$refs.file.value=""}))}}}},cs=os,ls=(s("6faa"),Object(k["a"])(cs,is,ns,!1,null,"41321d24",null)),ds=ls.exports,us=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-drawer",{staticClass:"ww-drawer-taskbar",attrs:{"append-to-body":!0,visible:t.showDrawerTaskBar,"with-header":!1},on:{"update:visible":function(e){t.showDrawerTaskBar=e}}},[s("task-bar")],1)},hs=[],ms=s("74a3"),ps={components:{TaskBar:ms["a"]},data:function(){return{showDrawerTaskBar:!1}},methods:{isShowDrawerTaskBar:function(){this.showDrawerTaskBar=!this.showDrawerTaskBar}}},fs=ps,gs=(s("0688"),Object(k["a"])(fs,us,hs,!1,null,"6011bfc0",null)),ks=gs.exports,_s={name:"TaskDetail",components:{AvatarTooltip:o["a"],SubTaskInput:v,SubTaskItem:b["a"],Description:Xt,TaskState:Se["a"],TaskComment:$e,Tag:Ge,CreateTagDialog:Xe,DeadlineDialog:p["a"],DurationDialog:as,DialogAssignee:ct["a"],TaskResult:ds,SetTaskPriority:Pe,DrawerTaskBar:ks,UserAvatar:lt["a"]},props:{taskId:{type:Number,default:0},isTrello:{type:Boolean,default:!1},confirmationScreen:{type:Boolean,default:!1}},data:function(){return{loadding:!1,is_edit:!1}},computed:{task:{get:function(){return this.$store.getters.selectedTask},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},task_id:function(){return this.task?this.task.task_id:""},projectName:function(){var t=this.task;return t.project?t.project.name:"Công việc của tôi"},project:function(){return this.$store.getters.selectedProject},user:function(){return this.$store.getters["user/profile"]},isDeleteTask:function(){var t=this;if("SYSTEM_ADMIN"===this.user.role||"ADMIN"===this.user.role||this.task.user_id===this.user.user_id)return!0;var e=this.project.leader_ids;return!!e&&e.findIndex((function(e){return e.user_id===t.user.user_id}))>=0}},mounted:function(){this.realtime()},updated:function(){this.realtime()},methods:{getPriorityTextById:r["s"],getStateTextById:r["u"],cancelEdit:function(){this.handleUpdateTaskName()},handleUpdateTaskName:function(){var t=this,e=this.task;Object(c["s"])(e.task_id,{name:e.name}).then((function(e){var s=e.data;t.task=s,t.is_edit=!1,t.$message.success("Thành công!")}))},handleOpenAssigneeDialog:function(){this.$refs.dialog_assignee.showDialog()},handleOpenDeadlineDialog:function(t){1===this.task.state||"from"!==t?1===this.task.state||"to"!==t?this.$refs.deadline_dialog.showDialog():this.$refs.deadline_to_dialog.showDialog():this.$message.warning("Công việc không thể thay đổi ngày bắt đầu!")},handleOpenDurationDialog:function(){this.$refs.duration_dialog.showDialog()},handleOpenCreateTag:function(){this.$refs.create_tag.showDialog()},pushSubTask:function(t){this.task.sub_tasks.unshift(t)},showDrawerTaskBar:function(){this.$refs.drawerTaskBar.isShowDrawerTaskBar()},optionalDate:function(t){return{strDefault:t}},checkExists:function(t,e){var s=t.find((function(t){return t.task_comment_id===e.task_comment_id}));return"object"===Object(n["a"])(s)},realtime:function(){var t=this;this.$route.query.task_id&&window.Echo.channel("task-comment-"+this.$route.query.task_id).listen(".pushed",(function(e){var s=e._comment;if(s.task_id===t.task.task_id){var a=t.task;t.checkExists(Object.assign([],t.task.comments),s)||(0!==s.parent_id?a.comments.map((function(e){return e.child_comments&&e.task_comment_id===s.parent_id&&!t.checkExists(Object.assign([],e.child_comments),s)&&e.child_comments.push(s),e})):a.comments.unshift(s))}}))},taskRemove:function(){var t=this;if(!this.isDeleteTask)return this.$message.warning("Bạn không được phép xóa công việc này!");confirm("Bạn muốn xóa công việc này?")&&Object(c["h"])(this.task.task_id).then((function(){t.$store.commit("task/SET_SELECTED_TASK_ID",null),t.$store.commit("task/SET_SELECTED_TASK",null)}))}}},vs=_s,bs=(s("ac2d"),s("cba9"),Object(k["a"])(vs,a,i,!1,null,"fd346dde",null));e["a"]=bs.exports},"807b":function(t,e,s){t.exports=s.p+"static/img/project.381b4037.png"},8170:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAYAAAA+s9J6AAAOqklEQVR4nO2dT8hldRnHP8WALmYxuZIYpEJcSYuXQUImg1ERrMZwmlArJ3FijMgxBP8sZJQWU9QgBqZiQlPICFOCDoWVXsikRRSERAuJCHHRImwWszBq0eK8v94z13vv+fc8v3/n+4Hh3ve+9z7nvJfzmef5Ped3fucDnzzxHkIUwh7gXxt+/1Hg73F2xYbXH72EXal3QogObgAe7vnen7WePwi8ar879khCkSt3Ake2nx/o+Zmt1vPvbD+eBb4H/Ndov8yRhCI39rCT0frKt4qt1uNh4DngBxPiuSEJRU4cBI4zTb5VBCHvBj4FXDCOP4kPpt4BIbY5io+Aga3tf78B9jltYxSSUOTAUeB2/ARsswU8A9wRYVu9kIQiNTEFDGwB929vOzmSUKQkhYCBLeBrZCCiJBSpSClgIAsRJaFIQQ4CBoKIycaIklDEJicBA0nHiJJQxCRHAQPJSlNJKGKRs4CBJCJKQhGDm8lfwEB0ESWhiMH9qXdgIFGbNZJQxOD67cdF0r0YRrRmjSQUsShVRPfSVBKKmEjEFUhCERuJuIQkFCkoWUTzZo0kFKkoVUTzZo0kFCkpVUTT0lQSijHsBV4zijV7ESWhGMpe4PT2c4loIKIkFEMIAh5gZwqaRJzYrJGEoi9tAQMS0aBZIwlFH1YJGJCIE0tTSSi62CRgQCJOEFESik30ETAgEUeKKAnFOoYIGJCII5o1klCsYoyAAYk4sFkjCcUyUwQMSMQBpakkFG0sBAxIxJ4iSkIRsBQwIBF3RPzKujdIQgE+AgYkYiPiN4D9q34pCQXszAX1QiI2Ij4BfHj5F5JQQJyDWiI2Ip5bflESioBEjMdD7R8koWgjEf3ZAg4Du8MLklAsIxH92QJOhR8koViFRPRnX3giCcU6JKI/R0ESis1IRD/CSXxJKDqRiI5c9+i/d0lC0QeJ6MMW8B9JWC+naQ7oS43iSUQnJGGdPE8zH/QA8HMkImQsoiSsj9PA5ewczBIxcxElYV2cZicDtpGIGYsoCethnYCBIKIVEtEISVgH7TFgF2rWNGQjoiQsn+e5eAy4ibB8vUrThixElIRlM0TANhIxIxElYbksd0GHIhHTi7gAPiQJy6SrCdMXNWsSi/j6o5ecl4TlMaQJ05fXaF1kOhGJ2J+3QOVoaYwdA24ixPquYUyJ2M0COAmSsCQ8BITmYHiX7ctqDJGI3bwNkrAUpjZh1hEEPGwcNyARV7MADoUfJGH+WDVhlvEWMCARL2YBnAXOhxckYd54NGEgnoABiXhxrKfbL0rCfCm1BF3H3EUMMa5f/oUkzBPPDAjxBQzMVcS1AoIkzBHPDAhrDoSIzE3Ezu9dEuaFZxMG0gsYmIuIvb53SZgP3iVoLgIGahex9/cuCfPA80Q82Ap4G/CYUaxaRRz0vUvC9JQ0BjwKfJXmZpcPdby3L7WJOPh7l4RpKWkMeBS4nZ0Lg29EIsLF+zzqe5eE6ShJwHvYETAQRHzAaBulizj6e5eEaSipCXOU5rziqn09ANyEMiI0EyBGfe+SMD4lNWFWZcBlVJo2+zx6AoQkjEtJAm7KgMtIxAlIwniU1gXtyoDLSMSRSMI4lN6E6YuaNSOQhP6UJmDfEnQdatYMRBL6UlIX1ELAgErTAUhCP2ptwvRFIvZEEvpQexOmLxKxB5LQntLGgF4CBtSs6UAS2jLXMWAXatZsQBLaUVIJGlPAQMiItxnFq0ZESWhDSRnQownTh/C3vGAYM/UNXUyQhNMpKQN6NmE24Xl1fwwRXVclkITTUBOmmxjLa3itEboAPm0YcyWScDwllaApxoAQd30brzVC3zOItxFJOI6STsTPQcCA+xqhHkjC4ZQ2BpyLgAHXNUI9kITDKGkMWGMTpi9TRIy+35KwPyUJWHMTpi9D1wiN0oRZhSTsR0lNmDmWoOsYukaoexNmFZKwm9KaMHPPgMuYrhHqgSTcTEkC1pgB9xvFMVsj1ANJuJ7SuqC1ZcCHaJbbf9wo3ioRkwsIknAdasJ04y3gjTR/08eBk0Zx2yImacKsYlfqHciQkgSssQRtC0jr8XHgmwbxs8h+bZQJL6akLmjtGbBNyIhWpWlWSMId1ITpxlPAx1gtYKBaESVhg5ow3XhnwP10/01ViigJyxoDzqkEXYd1syY5c5ewtDFgbSXoUAEDB4BrqCQjzlnCkkpQCfh+qilN5yphSRmwxibMVAEDVYg4RwlLyoC1NmEsBAwUL+LcJFQTphtPAR/AVsBAEPEp47hRmNOMmZLOA2oMOI4/OsZ2Yy6ZUAJ2U7KAC+Al4IdO8V2Zg4QlCagmzHCCgN93iu9O7RKqCdONBExMzWPC0powtWVAryZMYAGco3ABoV4JVYJ2owyYCTVKWJKANWZACTiQ2saEJQmoDDic6gSEuiRUE6YbCZghtZSjXk2YgErQzagJM4EaJPQU0HpBIJWgw6k2AwZKl9BrDAg7AlqtylxjBpSABpQsoXcTxlLAGjNgjBK0egGhXAm9mjABNWE28wBwExLQhBIl9B4D3mIYr8YS9D78Bay2CbOK0iT0HgMeAi4YxatRQGVAB0qS0LMEDRlQAq4nhoCzyoCBUiQsKQPW2oRRBnSiBAm9M6B1F1RNmGHMWkDIX0LvJswhdB5wE2rCRCBnCWOUoOeN4tUooDJgJHKdwC0Bu5GAlZCjhN4CHsFOQDVhhiMBl8itHPVuwlhmQDVhhrMAzgJPO8Uvkpwk9G7CWGbAGkvQGE2Yl5CA7yMXCWOUoO8YxVMJOhxlwA3kIKG3gHdhJ2CNGVACJiZ1YyaGgG8bxVMGHI4E7EHKTOjdhLEuQWtrwsQYA0rAHqSS0LsJcwyVoJu4F/gsEjALUkjoXYIeA/5qFK/GEvQ+JGBWxJawJAFrzIASMENiNma8x4DHUQbchATMlFiZ0HsMaNkFvZM6mzASMFNiSOgt4HHsBKyxBI3RhNFMmAl4S+g9BjwO/NkonkrQ4SyAMxR6h9xc8JTwKcoRsMYMGKsElYAT8WrMXAtcRRkCKgMOR2NAQ7wy4bco4zRErTNhVIIWRA4TuPtifRqixhI01kwYCWiIh4RXO8RcAA+iMeAmlAELxWNM+EVsD4Qg4B+M4knA4UhARzwkvMYwlrWAasIMRwI6Y12OXmoYy6MLqibMMCRgBKwl/AI2B4TGgN3cg5owVWAt4RGDGAvgEVSCbuJemhvYKANWQG6nKBbAKeB3RvFqzIASsDIsGzPXGsX5hVEcZcDhSMAEWGbCrxP/gF9HjU2YGAKeBn7sFF+swVLCyyd+fgGcNNiPGkvQe4iTASVgAqwk3GsU59WJn1cJOhxlwMRYSfgl0peiNWZACTgDrBozNxrEODfhs8qAw5GAmZB6Be7AAnhx5GfVhBmOBMwIi3L0VoMYMG6dmBpL0BhNGAmYERYSWpya+MeIz6gEHc4CeBZ4wSm+GEEO5eiYUxMqQYcjATNlaibcZ7IXwydqvwD8CbiBi5tCnlJKQOHCVAmPkebUxAWaCd5/AL69/doe4Drgy8Bl269Z7VvpAj7J+MaXcGaqhB8z2IdnDWJAcyvsl7f/AewGPkIzbty//dqYA730JsyzSMCsmSKhxSyZBfCKQZxVXKApc0Ope3T7ccgBrwwo3JnSmPkMNgfQeYMYfRh6ZYAEFFGYIuFhg+2/YRDDg9JLUAlYEGMltFhLZgH8xCDOEN7s8R5vAT3PbS6AJ5CARTFWwv3YHEhWC/n25bcdv/cU0HtyQciAL3e9UeTF2MbMw6Z7EY9NmbCGDCgBCyTVjJkFcCLBdv/JjmxtJKBIxphMeKXRtlM0ZVZ1YksX8BR26/KIBIyR8G7SX8BrRekCnmT6agQiMWPKUYtl7s8axJhK6U2YU0jAKhiaCfcYbHNB2onEL7Wel5oBT5DvOVYxkKGZ8CBlzZJZxV+2HyWgyIKhEloscz/mAl5L3kACioyIvQy+1dqiU3jPIWYMAR/B7vYAIiOGZMJUF/DmTowmzAkkYLUMyYQPUs+pCStiZEDLm6SKDBmSCS/rfksnVhfw5oAEFCb0zYQWs2QW1NNUiCGg5V2KRcb0zYSfx+aAe8cgRmpijAEl4IzoK6HFMve/N4iRGu+lFq1vEy4KINYpigXwfKRteRFDwGPEv8ZSJKaPhAeNtlXy/+4xxoAScKb0kfA48z41EWNRJgk4Y2KVo09G2o4lV9NcLAu+Ah6hjoaVGEmXhBazZBasvpo9R/bRXC951fbP3svq34UEnD1dElotc5/yqolNXArcTHNnqUCM0nsBHCLf70VEpEtCi2Xuc+NKmmwXLk5OcWcnCSj+zyYJrzDczmv4XD7Uh900oh1vvZai0RRK8ltolugXAtgs4eewOVgP0ByAMUW8gibbTbkRjAep/iMSGbNJwlsMtxNDxIOkz3araGdAId5HzIt6rUW8AriDeDcJHYPnYlKiEtZJuH/N61OZIuJu4BNcvPp3btK1kYCiF+skfAy/A3yIiMvZLmfp2khA0ZvYa8wENol4M3D/0ntLQgKKQayS0GqZ+y7aIr7FziyV8LsSkYBiMKskjLnM/YGlx5JZ0ExBs1gWUsyIVRJaLHM/J0L20ywYMYplCXcn2YsyCfJpKQoxiWUJb6WO0tCD9pUgTwC/wmchYTEzliXUeOZi2uJpCXrhQqpTFDkTxHsTeA6VmsKZtoRes2Ryp53tzgE/Qg0WEZG2hJ6zZHJjeXyn+72LZMypHA3ivQM8g26wIjIhSLg36V74EcT7Jc3dgd9OuC9CrCRIeJo6StF2mXmKJttpfCeypoZyNIj3N5rxnbqZoih2Abel3okRBPHOAS+iMlMUzC7gTOqd6EG7zDxJc9Jcs1VEFeRcjuqkuZgFOUnYznanacpMLQ0oqie1hEG8d2maKpqbKWZHbAnb2e7XwE/R3YjEzIkhoaaICbEBLwmDeG/R3BZNTRUh1mAlYTvbnaEpMzVTRYgeTJFw+dzdqxP3RYhZMlTCIN4Z4BV0g0shJjNUQt1bXQhj/gfP06VOlLUtyAAAAABJRU5ErkJggg=="},"81c5":function(t,e,s){},8266:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"ww-task",attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"550px","append-to-body":"","destroy-on-close":"","custom-class":"custom-scroll"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-position":"top","label-width":"160px",rules:t.rules}},[a("el-form-item",{staticClass:"form-item",attrs:{prop:"name"}},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("8170"),width:"11px"}})]),t._v(" Tên công việc "),a("span",{staticClass:"form-item__require"},[t._v("*")])]),a("el-input",{attrs:{size:"small",placeholder:"Nhập tên công việc"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{staticClass:"form-item"},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{staticStyle:{"margin-left":"3px"},attrs:{src:s("b792"),width:"13px"}})]),t._v(" Nhập mô tả công việc ")]),a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},size:"small",placeholder:"Nhập mô tả công việc"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),a("el-form-item",{staticClass:"form-item"},[a("el-input",{attrs:{size:"small",placeholder:"Nhập tên công việc con"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addSubtask()}},model:{value:t.subtask.name,callback:function(e){t.$set(t.subtask,"name",e)},expression:"subtask.name"}},[a("template",{slot:"prefix"},[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("4f4e"),width:"18px"}})])]),a("template",{slot:"suffix"},[a("span",[t._v("Enter")])])],2)],1),t._l(t.formData.sub_tasks,(function(e,i){return a("div",{key:i,staticClass:"form-item subtask-add"},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("4f4e"),width:"18px"}})]),t._v(" "+t._s(e.name)+" ")]),a("div",{staticClass:"action"},[a("span",{staticClass:"assignee",on:{click:function(e){return t.handleOpenAssigneeDialog(i)}}},[e.assignee_id?a("user-avatar",{attrs:{user:e.assignee,width:13,"font-size":9,"line-height":13,"border-radius":50}}):a("img",{attrs:{src:s("ba97"),width:"13px"}})],1),""==e.deadline_to?a("svg-icon",{staticClass:"date-range",staticStyle:{opacity:"40%"},attrs:{"icon-class":"date_range"},on:{click:function(e){return t.handleOpenDeadlineDialog(i)}}}):a("span",{staticClass:"date-range",on:{click:function(e){return t.handleOpenDeadlineDialog(i)}}},[a("svg-icon",{staticClass:"date-range",staticStyle:{opacity:"40%"},attrs:{"icon-class":"date_range"}}),t._v(" "+t._s(t.formatDate(e.deadline_to))+" ")],1),a("svg-icon",{attrs:{"icon-class":"trash"},on:{click:function(e){return t.removeSubtask(i)}}})],1)])})),a("el-form-item",{staticClass:"form-item"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("ba97"),width:"17px"}})]),t._v(" Giao cho "),a("span",{staticClass:"form-item__require"},[t._v("*")])]),a("el-select",{staticStyle:{width:"95%"},attrs:{filterable:"",size:"small"},on:{focus:t.changeAssigneer},model:{value:t.formData.assignee_id,callback:function(e){t.$set(t.formData,"assignee_id",e)},expression:"formData.assignee_id"}},t._l(t.users,(function(t){return a("el-option",{key:"user-"+t.user_id,attrs:{label:t.name,value:t.user_id}})})),1)],1),a("el-col",{attrs:{span:12}},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("ee32"),width:"13px"}})]),t._v(" Thời gian hoàn thành ")]),a("el-date-picker",{staticStyle:{width:"100%"},attrs:{format:"dd/MM/yyyy","value-format":"timestamp",type:"date",placeholder:"Chọn ngày hoàn thành",size:"small","picker-options":t.pickerOptions},model:{value:t.formData.deadline_to,callback:function(e){t.$set(t.formData,"deadline_to",e)},expression:"formData.deadline_to"}})],1)],1)],1),a("el-form-item",{staticClass:"form-item"},[a("el-row",[a("el-col",{staticClass:"project",attrs:{span:12}},[a("el-form-item",{attrs:{prop:"project_id"}},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("807b"),width:"20px"}})]),t._v(" Tên dự án "),a("span",{staticClass:"form-item__require"},[t._v("*")])]),t.isShowProjectSelect?a("el-select",{staticStyle:{width:"50%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"Dự án"},on:{change:t.triggerProject},model:{value:t.formData.project_id,callback:function(e){t.$set(t.formData,"project_id",e)},expression:"formData.project_id"}},t._l(t.projects,(function(t){return a("el-option",{key:t.project_id,staticClass:"custom-item",attrs:{label:t.name,value:t.project_id}})})),1):t._e()],1),t.isShowProjectSelect?t._e():a("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",disabled:"",value:t.project.name}})],1),a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",size:"small",placeholder:"Nhóm công việc"},model:{value:t.formData.task_group_id,callback:function(e){t.$set(t.formData,"task_group_id",e)},expression:"formData.task_group_id"}},[a("el-option",{attrs:{value:0,label:"Chưa xác định"}}),t._l(t.taskGroups,(function(t){return a("el-option",{key:"task-group-"+t.task_group_id,attrs:{label:t.name,value:t.task_group_id}})}))],2)],1)],1)],1),a("el-form-item",{staticClass:"form-item"},[a("label",[a("span",{staticClass:"form-item__circle"},[a("img",{attrs:{src:s("ba97"),width:"17px"}})]),t._v(" Người theo dõi "),a("span",{staticClass:"form-item__require"},[t._v("*")])]),a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:""},model:{value:t.formData.ref_ids,callback:function(e){t.$set(t.formData,"ref_ids",e)},expression:"formData.ref_ids"}},t._l(t.users,(function(t){return a("el-option",{key:"user-"+t.user_id,attrs:{label:t.name,value:t.user_id}})})),1)],1),a("el-form-item",{staticClass:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),a("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v(t._s("create"==t.dialogStatus?"Thêm mới":"Cập nhật"))])],1)],2),a("dialog-assignee",{ref:"dialog_assignee",on:{passAssignee:t.receivedAssignee}}),a("deadline-dialog",{ref:"deadline_to_dialog",attrs:{type:"date",title:"Ngày hoàn thành"},on:{passDeadline:t.receivedDeadline}})],1)},i=[],n=(s("a9e3"),s("b0c0"),s("a4d3"),s("e01a"),s("d3b7"),s("07ac"),s("a434"),s("941b")),r=s("b199"),o=s("24d2"),c=(s("cc1d"),s("02d1")),l=s("3b86"),d={components:{DialogAssignee:n["a"],DeadlineDialog:c["a"],UserAvatar:l["a"]},props:{formId:{type:Number,default:0},taskGroupId:{type:Number,default:null},isShowProjectSelect:{type:Boolean,default:!1}},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,projects:[],taskGroups:[],textMap:{update:"Cập nhật",create:"Tạo mới công việc"},formData:this.initFormData(),rules:{name:[{required:!0,message:"Chưa nhập tên công việc",trigger:"change"}],project_id:[{required:!0,message:"Chưa chọn dự án!",trigger:"change"}]},pickerOptions:{disabledDate:function(t){var e=new Date;return e.setDate(e.getDate()-1),t.getTime()<e}},subtask:{current:0,name:"",assignee:{}},offsetTime:25200}},computed:{users:function(){return this.$store.getters["project/members"]},project:function(){return this.$store.getters["selectedProject"]||{name:""}},projectId:function(){return this.$route.params.projectId||this.formData.project_id},user_id:function(){return this.$store.getters["user_id"]}},watch:{formId:function(t,e){this.resetFormData(),this.dialogStatus=0!==t?"update":"create"},projectId:function(t){this.fetchTaskGroup()},dialogFormVisible:function(t){t&&(this.fetchTaskGroup(),this.formData.task_group_id=this.taskGroupId)}},created:function(){this.isShowProjectSelect||this.$store.dispatch("project/fetchMembersInProject",this.$route.params.projectId),this.fetchProject()},methods:{callDialog:function(t){var e=this;t?this.$nextTick((function(){e.formData={deadline_to:e.$moment(t.deadline_to),name:t.name,description:t.description,assignee_id:t.assignee_id,project_id:t.project_id,ref_ids:t.ref_ids,task_group_id:t.task_group_id||0,sub_tasks:t.sub_tasks}})):(this.formData=this.initFormData(),this.$refs["dataForm"]&&this.$refs["dataForm"].resetFields()),this.dialogFormVisible=!this.dialogFormVisible},showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},initFormData:function(){return{name:"",description:"",assignee_id:"",deadline_to:"",ref_ids:[],task_group_id:0,sub_tasks:[]}},resetFormData:function(){this.formData=this.initFormData(),this.$refs["dataForm"]&&this.$refs["dataForm"].resetFields()},showPwd:function(){var t=this.passwordType;this.passwordType="password"===t?"text":"password"},fetchTaskGroup:function(){var t=this,e=this.projectId;e&&Object(o["e"])(e).then((function(e){var s=e.data;t.taskGroups=s}))},fetchTask:function(t){var e=this;t&&(this.loading=!0,Object(r["j"])(t).then((function(t){var s=t.data;e.formData=s})).finally((function(){e.loading=!1})))},fetchProject:function(){var t=this;this.isShowProjectSelect||(this.rules.project_id=!1),Object(o["h"])().then((function(e){t.projects=e.data}))},fetchShareUsers:function(){var t=this;Object(o["k"])(this.$route.params.projectId).then((function(e){t.users=e.data}))},receivedAssignee:function(t){this.formData.sub_tasks[this.subtask.current].assignee_id=t.user_id,this.formData.sub_tasks[this.subtask.current].assignee=t,this.changeFormData()},changeFormData:function(){var t=this.formData;this.formData={},this.formData=t},receivedDeadline:function(t){this.formData.sub_tasks[this.subtask.current].deadline_to=t,this.changeFormData()},handleOpenAssigneeDialog:function(t){this.subtask.current=t,this.isShowProjectSelect&&this.$store.dispatch("project/fetchMembersInProject",this.formData.project_id),this.$refs.dialog_assignee.showDialog()},handleOpenDeadlineDialog:function(t){this.subtask.current=t,this.$refs.deadline_to_dialog.showDialog()},addSubtask:function(){this.formData.sub_tasks[Object.values(this.formData.sub_tasks).length]={name:this.subtask.name,assignee_id:"",deadline_to:""},this.subtask.name=""},removeSubtask:function(t){confirm("Bạn có muốn xóa subtask ".concat(this.formData.sub_tasks[t].name,"?"))&&this.formData.sub_tasks.splice(t,1)},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formId,a=t.formData,i=t.projectId,n=t.user_id;t.isShowProjectSelect||(a.project_id=i),t.formData.confirm_status=1,s?(t.formData.deadline_to=t.formData.deadline_to?t.formData.deadline_to/1e3+t.offsetTime:null,Object(r["s"])(s,t.formData).then((function(e){t.loading=!1,t.$message({type:"success",message:"Thành công"}),t.hideDialog(),t.resetFormData(),t.$emit("reloadList"),t.$route.params.projectId&&t.$store.dispatch("report/fetchReportUser",t.$route.params.projectId)})).finally((function(){t.loadingBtn=!1}))):Object(r["c"])(a).then((function(e){if(t.loading=!1,t.$message({type:"success",message:"Thành công"}),t.hideDialog(),t.resetFormData(),t.$emit("reloadList"),t.$store.dispatch("report/fetchCalendar",{projectId:t.$route.params.projectId}),void 0===t.$route.params.projectId){var s={assignee_id:n};"in"===t.$route.query.project_id&&(s={}),t.$store.dispatch("task/getTasksByDepartmentAndGroups",{projectId:"in",params:s})}t.$route.params.projectId&&t.$store.dispatch("report/fetchReportUser",t.$route.params.projectId)})).finally((function(){t.loadingBtn=!1}))}}))},triggerProject:function(){this.formData.project_id&&(this.$store.dispatch("project/fetchMembersInProject",this.formData.project_id),this.formData.assignee_id="")},changeAssigneer:function(){this.$refs["dataForm"].validate()}}},u=d,h=(s("f17a"),s("2877")),m=Object(h["a"])(u,a,i,!1,null,null,null);e["a"]=m.exports},"828d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wdg-right-bar"},[t.projectOfMe&&!t.selectedTaskId?s("user-bar"):t._e(),t.projectOfMe&&t.selectedTaskId?s("task-bar"):t._e(),!t.projectOfMe&&t.selectedProjectId?s("project-bar"):t._e()],1)},i=[],n=s("74a3"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-page-info project-bar"},[s("div",{staticClass:"box my-task"},[s("h3",{staticClass:"title"},[t._v(t._s(t.selectedProject?t.selectedProject.name:""))]),s("div",{staticClass:"description"},[s("svg-icon",{attrs:{"icon-class":"sort"}}),t.isEditDescription?s("div",{staticClass:"edit"},[s("el-input",{attrs:{placeholder:"Mô tả dự án. Enter để cập nhật"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.updateDescription(e)}},model:{value:t.selectedProject.description,callback:function(e){t.$set(t.selectedProject,"description",e)},expression:"selectedProject.description"}})],1):s("div",{staticClass:"cursor-pointer",on:{click:function(e){t.isEditDescription=!0}}},[t._v(" "+t._s(t.selectedProject&&t.selectedProject.description?t.selectedProject.description:"Chưa có dữ liệu")+" ")])],1),s("div",{staticClass:"task-summery"},[s("div",{staticClass:"percent-check"},[s("el-checkbox",{attrs:{checked:!0,disabled:""}},[t._v(t._s(t.report.total_done)+"/"+t._s(t.report.total_tasks)+" hoàn thành")]),s("span",{staticClass:"percent-text"},[t._v(t._s(t._f("roundPercent")(t.percenTaskDone))+"%")])],1),s("percent-slide",{attrs:{"percent-done":t.percenTaskDone}})],1)]),s("div",{staticClass:"project-time-report"},[s("div",{staticClass:"header"},[s("label",[t._v("Thời gian dự kiến")]),s("div",{staticClass:"due-date",attrs:{title:"Ngày bắt đầu - Ngày kết thúc"},on:{click:function(e){return t.handleOpenDeadlineDialog()}}},[!t.selectedProject||t.selectedProject.deadline_from||t.selectedProject.deadline_to?t._e():[s("i",{staticClass:"el-icon-date"})],t.selectedProject&&(t.selectedProject.deadline_from||t.selectedProject.deadline_to)?[s("span",{domProps:{textContent:t._s(t.formatDate(t.selectedProject.deadline_from)+" - "+t.formatDate(t.selectedProject.deadline_to))}})]:t._e()],2)]),s("div",{staticClass:"content"},[s("div",{staticClass:"time time--done"},[s("label",[t._v("Thời gian đã hoàn thành")]),s("div",{staticClass:"total",domProps:{textContent:t._s(t.report.total_done_time_string)}})]),s("div",{staticClass:"time time--remain"},[s("label",[t._v("Thời gian còn lại")]),s("div",{staticClass:"total",domProps:{textContent:t._s(t.countdown)}})])])]),s("div",{staticClass:"box department"},[s("svg-icon",{attrs:{"icon-class":"department"}}),s("span",[t._v(" Department: "),s("span",{staticClass:"department__name cursor-pointer",on:{click:function(e){t.departmentDialog=!t.departmentDialog}}},[t._v(t._s(t.selectedProject&&t.selectedProject.department?t.selectedProject.department.name:"Chưa phân loại"))]),s("el-dialog",{attrs:{visible:t.departmentDialog,title:"Chọn Department",width:"250px"},on:{"update:visible":function(e){t.departmentDialog=e}}},[s("el-select",{model:{value:t.department_id,callback:function(e){t.department_id=e},expression:"department_id"}},t._l(t.departments,(function(t){return s("el-option",{key:t.department_id,attrs:{label:t.name,value:t.department_id}})})),1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.changeDepartment}},[t._v("Lưu")])],1)],1)],1)],1),s("div",{staticClass:"box"},[s("h3",{staticClass:"box-title"},[t._v("Mục tiêu")]),s("div",{staticClass:"box-content"},[t.selectedProject?s("div",{staticClass:"target-list"},t._l(t.selectedProject.targets,(function(e){return s("div",{key:e.target_id,staticClass:"target"},[s("span",{staticClass:"calender"},[s("svg-icon",{attrs:{"icon-class":"calendar"}}),s("span",{staticClass:"deadline"},[t._v(t._s(e.deadline))])],1),s("span",{staticClass:"title"},[t._v(t._s(e.name))]),e.user?s("span",{staticClass:"detail"},[t._v(t._s(e.user.name)+" - "+t._s(e.total_task_done)+"/"+t._s(e.total_task))]):t._e()])})),0):t._e(),s("div",{staticClass:"action bottom"},[s("div",{staticClass:"popup-wrapper"},[s("span",{staticClass:"button",on:{click:t.handleOpenTargetFormDialog}},[s("span",{staticClass:"icon"},[s("svg-icon",{attrs:{"icon-class":"plus"}})],1),s("span",{staticClass:"title"},[t._v("Thêm mục tiêu")])])])])])]),s("div",{staticClass:"box box-statistic"},[s("h3",{staticClass:"box-title"},[t._v("Thông tin chung")]),s("div",{staticClass:"box-content"},[t.selectedProject?s("pie-chart"):t._e(),s("el-collapse",[s("el-collapse-item",{attrs:{name:"1"}},[s("span",{staticClass:"icon icon-danger",attrs:{slot:"title"},slot:"title"},[s("svg-icon",{attrs:{"icon-class":"warning"}}),t._v("Quá hạn gần đây "),s("span",{staticClass:"count"},[t._v(t._s(t.selectedProject&&t.selectedProject.task_out_date_nearly?t.selectedProject.task_out_date_nearly.length:0))])],1),t.selectedProject?s("div",{staticClass:"task-list"},t._l(t.selectedProject.task_out_date_nearly,(function(e){return s("task-item",{key:e.task_id,attrs:{task:e,"task-type":t.STATE_OUT_DATE}})})),1):t._e()]),s("el-collapse-item",{attrs:{name:"2"}},[s("span",{staticClass:"icon",attrs:{slot:"title"},slot:"title"},[s("svg-icon",{attrs:{"icon-class":"start"}}),t._v("Chưa bắt đầu "),s("span",{staticClass:"count"},[t._v(t._s(t.selectedProject&&t.selectedProject.task_new?t.selectedProject.task_new.length:0))])],1),t.selectedProject&&t.selectedProject.task_new?s("div",{staticClass:"task-list"},t._l(t.selectedProject.task_new,(function(e){return s("task-item",{key:e.task_id,attrs:{task:e,"task-type":t.STATE_NEW}})})),1):t._e()]),s("el-collapse-item",{attrs:{name:"3"}},[s("span",{staticClass:"icon",attrs:{slot:"title"},slot:"title"},[s("svg-icon",{attrs:{"icon-class":"graph"}}),t._v("Thống kê thành viên ")],1),t.selectedProject?s("div",{staticClass:"user-list"},t._l(t.selectedProject.task_summery_by_user,(function(e){return s("user-with-task",{key:e.assigne_id,attrs:{users:t.users,item:e,"total-task":t.selectedProject.task_summery.total_task}})})),1):t._e()])],1)],1)]),t.selectedProject&&3!==t.selectedProject.type?s("div",{staticClass:"box users"},[s("project-members",{attrs:{title:"Quản lý",users:t.selectedProject.leader_ids,"is-leader":!0}}),s("project-members",{attrs:{title:"Thành viên",users:t.selectedProject.member_ids,"is-leader":!1}}),s("project-members",{attrs:{title:"Bộ phận",users:t.selectedProject.user_groups,"is-user-group":!0}})],1):t._e(),s("target-form-dialog",{ref:"target_form_dialog",on:{afterPost:t.putTargetToProject}}),s("deadline-dialog",{ref:"deadline_dialog",attrs:{type:t.deadlineDialogType,title:t.deadlineProject,"execute-for":"project"},on:{"update:type":function(e){t.deadlineDialogType=e}}})],1)},o=[],c=(s("fb6a"),s("4de4"),s("a4d3"),s("e01a"),s("7db0"),s("c740"),s("b0c0"),s("a434"),s("07ac"),s("02d1")),l=s("c570"),d=s("a688"),u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.className,style:{height:t.height,width:t.width}})},h=[],m=(s("159b"),s("313e")),p=s.n(m),f=s("cc1d");s("817d");var g={props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"200px"}},data:function(){return{chart:null,task:{task_id:null}}},computed:{taskReport:function(){return this.$store.getters["task/taskReport"]},report:function(){var t=this.$store.getters["report/user"],e={total_tasks_confirm:0,total_task_new:0,total_tasks_doing:0,total_tasks_review:0,total_tasks_done:0,total_tasks_done_late:0,total_tasks_out_date:0};return t.all.forEach((function(t){e.total_tasks_confirm+=t.total_tasks_confirm,e.total_task_new+=t.total_tasks_todo,e.total_tasks_doing+=t.total_tasks_doing,e.total_tasks_review+=t.total_tasks_review,e.total_tasks_done+=t.total_tasks_done,e.total_tasks_done_late+=t.total_tasks_done_late,e.total_tasks_out_date+=t.total_tasks_out_date})),e}},watch:{report:function(t){this.initChart()}},mounted:function(){this.initChart(),this.realtimeReport()},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=p.a.init(this.$el,"macarons"),this.chart.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"40%",top:"10",borderRadius:50,itemWidth:10,itemHeight:10},series:[{name:"",type:"pie",radius:[22,32],avoidLabelOverlap:!1,center:["20%","25%"],data:this.getArrayReport(),labelLine:{show:!1},label:{show:!1,position:"center"},animationEasing:"cubicInOut",animationDuration:2600}],color:["#8e44ad","#232323","#198CFF","#39D92A","#FFD527","#FF9B25","#F52121"]})},getArrayReport:function(){return[{value:this.report.total_tasks_confirm,name:this.report.total_tasks_confirm+" ".concat(f["a"])},{value:this.report.total_task_new,name:this.report.total_task_new+" ".concat(f["i"])},{value:this.report.total_tasks_doing,name:this.report.total_tasks_doing+" ".concat(f["g"])},{value:this.report.total_tasks_done,name:this.report.total_tasks_done+" ".concat(f["e"])},{value:this.report.total_tasks_review,name:this.report.total_tasks_review+" ".concat(f["l"])},{value:this.report.total_tasks_done_late,name:this.report.total_tasks_done_late+" ".concat(f["d"])},{value:this.report.total_tasks_out_date,name:this.report.total_tasks_out_date+" ".concat(f["k"])}]},realtimeReport:function(){var t=this;window.Echo.channel("confirmation-channel").listen(".pushed",(function(e){e._task;t.$store.dispatch("report/fetchReportUser",t.$route.params.projectId),setTimeout(t.initChart(),1e3)}))},updateProjectReport:function(){this.$route.params.projectId&&this.$store.dispatch("report/fetchReportUser",this.$route.params.projectId)}}},k=g,_=s("2877"),v=Object(_["a"])(k,u,h,!1,null,null,null),b=v.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-item"},[t.taskType==t.STATE_OUT_DATE?s("span",{staticClass:"icon icon-out-date"},[s("svg-icon",{attrs:{"icon-class":"warning"}})],1):s("span",{staticClass:"icon icon-new"},[s("svg-icon",{attrs:{"icon-class":"start"}})],1),s("div",{staticClass:"title",on:{click:t.goToTaskDetail}},[s("span",{staticClass:"name"},[t._v(t._s(t.task.name))])]),s("div",{staticClass:"date-info"},[s("span",{staticClass:"created-at"},[t._v(t._s(t.formatDate(t.task.created_at)))]),t.task.deadline_to?s("span",{staticClass:"deadline-to"},[t._v(t._s(t.formatDate(t.task.deadline_to)))]):t._e()])])},y=[],w=(s("a9e3"),{name:"StatisticTaskItem",props:{task:{type:Object,default:function(){}},taskType:{type:Number,default:f["h"]}},created:function(){this.STATE_NEW=f["h"],this.STATE_OUT_DATE=f["j"]},methods:{goToTaskDetail:function(){var t=this.task;this.$router.push({name:"project-task",params:{projectId:t.project_id},query:{task_id:t.task_id}})}}}),T=w,D=(s("e5b4"),Object(_["a"])(T,C,y,!1,null,"7ea2e29b",null)),j=D.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-with-task"},[s("user-block",{attrs:{user:t.user}}),s("span",{staticClass:"summery"},[t._v(t._s(t.item.total)+"/"+t._s(t.totalTask))])],1)},A=[],$=s("6b0d"),S={name:"UserWithTask",components:{UserBlock:$["a"]},props:{item:{type:Object,default:function(){}},totalTask:{type:Number,default:0},users:{type:Array,default:[]}},computed:{user:function(){var t=this.users,e=this.item,s={assignee_id:0,name:"Chưa được giao",title:"Chưa được giao"};if(t&&e){var a=e.assignee_id;a&&(s=t.find((function(t){return t.user_id===a})))}return s}}},I=S,O=(s("154d"),Object(_["a"])(I,x,A,!1,null,"b47650fa",null)),E=O.exports,B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"project-members"},[s("h3",{staticClass:"box-title"},[s("span",{domProps:{textContent:t._s(t.title)}}),t._v(" ("+t._s(t.users.length)+")")]),s("div",{staticClass:"box-content"},[s("div",{staticClass:"user-list custom-scroll",attrs:{"data-user":JSON.stringify(t.users)}},[t._l(t.users,(function(e,a){return[t.members.limit>0&&a+1<=t.members.limit||0===t.members.limit?s("user-block",{key:e.user_id||e.user_group_id,attrs:{user:e,"show-delete":!0,"is-leader":t.isLeader,"is-user-group":t.isUserGroup,"current-user-leader":t.currentUserIsLeader},on:{eventDelete:t.handleChooseMember,eventGetSetRole:t.changeRole}}):t._e()]})),t.users.length>t.members.limit?[s("div",{staticClass:"more"},[s("span",{domProps:{textContent:t._s(t.members.text)},on:{click:t.moreAction}})])]:t._e()],2),s("div",{staticClass:"action bottom"},[t.currentUserIsLeader?s("user-tag-popover",{attrs:{title:"Thêm "+t.title.toLowerCase(),"is-user-group":t.isUserGroup},on:{chooseUser:t.handleChooseMember}}):t._e()],1)])])},F=[],P=s("1da1"),M=(s("96cf"),s("99af"),s("d3b7"),s("323e")),L=s.n(M),R=s("24d2"),U=s("8c61"),N={components:{UserBlock:$["a"],UserTagPopover:U["a"]},props:{users:{type:Array,default:function(){return[]}},title:{type:String,default:"Quản lý dự án"},isLeader:{type:Boolean,default:!0},isUserGroup:{type:Boolean,default:!1}},data:function(){return{members:{limit:5,text:"Xem thêm"}}},computed:{isShow:function(t){return this.members.limit>0&&t+1<=this.members.limit||0===this.members.limit},selectedProject:{get:function(){return this.$store.getters.selectedProject},set:function(t){this.$store.commit("project/SET_SELECTED_PROJECT",t)}},project:function(){return this.$store.getters.selectedProject},user:function(){return this.$store.getters["user/profile"]},currentUserIsLeader:function(){var t=this;if("SYSTEM_ADMIN"===this.user.role||"ADMIN"===this.user.role)return!0;var e=this.project.leader_ids;return!!e&&e.findIndex((function(e){return e.user_id===t.user.user_id}))>=0}},methods:{handleChooseMember:function(t,e){var s=this;return Object(P["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=s.selectedProject,!s.isUserGroup){a.next=8;break}if(n=s.checkExists(i.user_groups,t,"user_group_id",e,"Bộ phận này đã được thêm vào dự án"),!n){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,Object(R["n"])(s.$route.params.projectId,{user_group_id:t.user_group_id}).then((function(t){s.$store.commit("project/SET_SELECTED_PROJECT",t.data),s.$store.dispatch("project/fetchMembersInProject",s.$route.params.projectId),s.$message.success("Cập nhật thành công")}));case 7:return a.abrupt("return");case 8:if(r=i.leader_ids.concat(i.member_ids),o=s.checkExists(r,t,"user_id",e,"Thành viên này đã là thành viên của dự án"),!o){a.next=12;break}return a.abrupt("return");case 12:L.a.start(),Object(R["a"])(i.project_id,{is_leader:s.isLeader,user_id:t.user_id}).then((function(t){s.updateMembers(t.data),s.$store.dispatch("project/fetchMembersInProject",s.$route.params.projectId),s.$message.success("Cập nhật thành công")})).finally((function(){L.a.done()}));case 14:case"end":return a.stop()}}),a)})))()},checkExists:function(t,e,s,a,i){var n=t?t.find((function(t){return t[s]===e[s]})):void 0;return!(!n||a)&&this.$message.warning(i)},changeRole:function(t){var e=this;Object(R["b"])(this.selectedProject.project_id,{user_id:t.user_id}).then((function(t){e.updateMembers(t.data)}))},updateMembers:function(t){var e=this.selectedProject,s=t.leader_ids,a=t.member_ids;e.leader_ids=s,e.member_ids=a,this.selectedProject=e},moreAction:function(){if(0===this.members.limit)return this.members.text="Xem thêm",void(this.members.limit=5);this.members.text="Ẩn bớt",this.members.limit=0}}},G=N,V=(s("dccc"),Object(_["a"])(G,B,F,!1,null,null,null)),J=V.exports,z={name:"ProjectBar",components:{DeadlineDialog:c["a"],TargetFormDialog:l["a"],PercentSlide:d["a"],PieChart:b,TaskItem:j,UserWithTask:E,ProjectMembers:J},data:function(){return{deadlineDialogType:"from",sections:[{value:25},{value:25}],deadline:new Date(Date.parse(new Date)+432e6),countdown:"0 phút",isEditDescription:!1,departmentDialog:!1,department_id:""}},computed:{selectedProject:function(){return this.$store.getters.selectedProject},percenTaskDone:function(){return this.report&&this.report.total_tasks>0?this.report.total_done/this.report.total_tasks*100:0},users:function(){return this.$store.getters.users},report:function(){return this.$store.getters["report/project"]},businessTime:function(){return this.$store.getters["user/businessTime"]},deadlineProject:function(){return this.selectedProject&&this.selectedProject.isDeadlineFrom?"Thời gian bắt đầu - Thời gian kết thúc":"Thời gian kết thúc"},departments:function(){return this.$store.getters.departments},projects:function(){return this.$store.getters.projects}},watch:{selectedProject:function(t){this.department_id=t&&t.department?t.department.department_id:""}},created:function(){this.STATE_NEW=f["h"],this.STATE_OUT_DATE=f["j"]},mounted:function(){var t=this;setTimeout((function(){t.initializeClock(t.report)}),1500)},methods:{putTargetToProject:function(t){var e=this.selectedProject;if(e){var s=e.targets;s?s.push(t):s=[t],e.targets=s,this.selectedProject=e}},handleOpenTargetFormDialog:function(){this.$refs.target_form_dialog.showDialog()},handleOpenDeadlineDialog:function(){this.deadlineDialogType=this.selectedProject.isDeadlineFrom?"daterange":"date",this.$refs.deadline_dialog.showDialog()},getTimeRemaining:function(t){var e=Date.parse(t)-Date.parse(new Date),s=Math.floor(e/1e3%60),a=Math.floor(e/1e3/60%60),i=Math.floor(e/36e5%8),n=Math.floor(e/288e5);return{total:e,days:n,hours:i,minutes:a,seconds:s}},initializeClock:function(t){var e=this,s=t.total_remain_time;if(this.checkWeekday(),0!==s&&void 0!==s){s=this.$moment().add(s,"hours"),i();var a=e.checkWeekday()&&t.is_count_down?setInterval(i,1e3):null}function i(){var t=e.getTimeRemaining(s);e.countdown=t.days+" ngày "+("0"+t.hours).slice(-2)+" giờ "+("0"+t.minutes).slice(-2)+" phút "+("0"+t.seconds).slice(-2)+" giây",t.total<=0&&clearInterval(a)}},checkWeekday:function(){var t=this.$moment().day(),e=this.$moment().format("HH:mm:ss"),s=this.businessTime.filter((function(t){return"mon-fri"===t.weekday}));return 0===t&&(s=this.businessTime.filter((function(t){return"sun"===t.weekday}))),6===t&&(s=this.businessTime.filter((function(t){return"sat"===t.weekday}))),(!s||0!==s.length)&&(s=s[0],e>=s.start_time&&e<=s.lunch_break_start||e>=s.lunch_break_end&&e<=s.end_time)},updateDescription:function(){var t=this;Object(R["m"])(this.selectedProject.project_id,{description:this.selectedProject.description}).then((function(e){t.isEditDescription=!1,t.$message.success("Cập nhật mô tả dự án thành công!")}))},changeDepartment:function(){var t=this;Object(R["l"])(this.selectedProject.project_id,{department_id:this.department_id}).then((function(e){var s=t.departments.find((function(e){return e.department_id===t.department_id}))||"";t.selectedProject.department=s,t.departmentDialog=!1;var a=t.$store.getters.projects,i=a.findIndex((function(e){return e.department_id===(t.department_id||0)}));-1===i&&(i=0,s.projects=[],s.department_name=s.name,a.unshift(s)),a[i].projects.unshift(e.data);var n=a.findIndex((function(e){return e.department_id===t.selectedProject.department_id}));if(-1!==n){var r=a[n].projects.findIndex((function(e){return e.project_id===t.selectedProject.project_id}));a[n].projects.splice(r,1),0===Object.values(a[n].projects).length&&a.splice(n,1),t.selectedProject.department_id=s?s.department_id:"",t.$store.commit("project/SET_SELECTED_PROJECT",t.selectedProject),t.$store.commit("share/SET_PROJECTS",a)}}))}}},Q=z,Y=(s("1998"),s("b598"),s("83fb"),Object(_["a"])(Q,r,o,!1,null,"51d5f038",null)),K=Y.exports,H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-page-info project-bar"},[s("div",{staticClass:"box my-task"},[s("div",{staticClass:"task-summery"},[s("div",{staticClass:"percent-check"},[s("el-checkbox",{attrs:{checked:!0,disabled:""}},[t._v(t._s(t.doneTotal)+"/"+t._s(t.total)+" hoàn thành")]),s("span",{staticClass:"percent-text"},[t._v(t._s(t._f("roundPercent")(t.percenTaskDone))+"%")])],1),s("percent-slide",{attrs:{"percent-done":t.percenTaskDone}})],1)]),s("div",{staticClass:"box box-statistic"},[s("div",{staticClass:"box-content"},[s("el-collapse",[s("el-collapse-item",{attrs:{name:"1"}},[s("span",{staticClass:"icon icon-danger",attrs:{slot:"title"},slot:"title"},[s("svg-icon",{attrs:{"icon-class":"assign_for_me"}}),t._v("Mới được giao ")],1),s("div",{staticClass:"task-list"})]),s("el-collapse-item",{attrs:{name:"2"}},[s("span",{staticClass:"icon",attrs:{slot:"title"},slot:"title"},[s("svg-icon",{attrs:{"icon-class":"assign_to"}}),t._v("Mới giao đi ")],1),s("div",{staticClass:"task-list"})])],1)],1)])])},X=[],W={name:"ProjectBar",components:{PercentSlide:d["a"]},data:function(){return{deadlineDialogType:"from"}},computed:{tasks:function(){return this.$store.getters["task/tasksByDepartmentGroupMe"]},total:function(){return this.tasks.length},doneTotal:function(){return this.tasks.filter((function(t){return 4===t.state})).length},percenTaskDone:function(){return this.total>0?this.doneTotal/this.total*100:0}}},q=W,Z=(s("d4de"),Object(_["a"])(q,H,X,!1,null,"0c1cf581",null)),tt=Z.exports,et={name:"RightBar",components:{TaskBar:n["a"],ProjectBar:K,UserBar:tt},props:{projectOfMe:{type:Boolean,default:!1}},computed:{selectedTaskId:function(){return this.$store.getters.selectedTaskId},selectedProjectId:function(){return this.$store.getters.selectedProjectId}}},st=et,at=Object(_["a"])(st,a,i,!1,null,null,null);e["a"]=at.exports},"83fb":function(t,e,s){"use strict";s("6d10")},"857d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"set-status"},[s("el-checkbox",{on:{change:t.updateState},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}})],1)},i=[],n=(s("d3b7"),s("cc1d")),r=s("b199"),o=s("323e"),c=s.n(o),l={name:"SetTaskStateCheck",props:{task:{type:Object,default:function(){}}},data:function(){return{state:this.task.state===n["b"],taskData:this.task}},computed:{setStateDone:function(){return this.$store.getters["task/setStateDone"]}},watch:{task:function(t){this.taskData=t},setStateDone:function(t){t===this.task.task_id&&(this.state=!0)}},methods:{updateState:function(){this.markTaskDone()},markTaskDone:function(){var t=this;return this.taskData.state===n["b"]?(this.state=!0,this.$message.warning("Công việc đã hoàn thành không được phép thao tác thêm")):2!==this.taskData.confirm_status?(this.state=!1,this.$message.warning("Công việc chưa được xác nhận")):(c.a.start(),void Object(r["s"])(this.taskData.task_id,{state:n["b"]}).then((function(e){t.taskData=e.data,t.$store.dispatch("taskGroup/fetchTaskGroupsByProjectId",{projectId:t.taskData.project_id}),t.$store.commit("task/SET_STATE_DONE",t.task.task_id),t.$store.dispatch("report/fetchReport",{projectId:t.$route.params.projectId}),t.$message.success("Cập nhật thành công")})).finally((function(){t.state=t.taskData.state===n["b"],c.a.done()})))}}},d=l,u=s("2877"),h=Object(u["a"])(d,a,i,!1,null,null,null);e["a"]=h.exports},"89c5":function(t,e,s){"use strict";s("bd7c")},"8acd":function(t,e,s){},"8baf":function(t,e,s){},"8c61":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"popup-wrapper"},[s("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click","popper-class":"user-tag-popover","visible-arrow":!1}},[s("div",{staticClass:"header"},[s("h3",{staticClass:"custom-title"},[t._v(t._s(t.title))])]),s("div",{staticClass:"input"},[s("el-input",{attrs:{placeholder:"Tìm kiếm"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),s("div",{staticClass:"user-list custom-scroll"},t._l(t.realUsers,(function(e){return s("div",{key:e.user_id,staticClass:"user-block",on:{click:function(s){return t.chooseUser(e)}}},[s("user-avatar",{attrs:{user:e,width:25,"font-size":12,"line-height":25,"border-radius":50}}),s("div",{staticClass:"user-info"},[s("span",{staticClass:"username"},[t._v(t._s(e.name))]),t.isUserGroup?t._e():s("span",{staticClass:"user-title"},[t._v(t._s(e.title||"No title"))])])],1)})),0),t._t("title",[s("span",{staticClass:"button",attrs:{slot:"reference"},slot:"reference"},[s("span",{staticClass:"icon"},[s("svg-icon",{attrs:{"icon-class":"plus"}})],1),s("span",{staticClass:"title"},[t._v(t._s(t.title))])])])],2)],1)},i=[],n=s("3835"),r=(s("4fad"),s("4de4"),s("caad"),s("2532"),s("b0c0"),s("c1f9"),s("3b86")),o=s("2ef0"),c=s.n(o),l={name:"UserTagPopover",components:{UserAvatar:r["a"]},props:{title:{type:String,default:"Thêm người dùng"},isAll:{type:Boolean,default:!0},isUserGroup:{type:Boolean,default:!1}},data:function(){return{keyword:""}},computed:{users:function(){return this.$store.getters.users},current_project_users:function(){return this.$store.getters.current_project_users},realUsers:function(){if(this.isUserGroup){var t=this.$store.getters.user_groups;return this.filterData(t)}var e=this.users;return this.filterData(e)}},created:function(){(this.$route.params.projectId||this.$store.getters.selectedProjectId)&&this.$store.dispatch("project/fetchMembersInDepartment",this.$route.params.projectId||this.$store.getters.selectedProjectId)},methods:{chooseUser:function(t){this.$emit("chooseUser",t)},filterData:function(t){var e=this;return c.a.flow([Object.entries,function(t){return t.filter((function(t){var s=Object(n["a"])(t,2),a=(s[0],s[1]);return a.name.toLowerCase().includes(e.keyword.toLowerCase())}))},Object.fromEntries])(t)}}},d=l,u=(s("c6cb"),s("2877")),h=Object(u["a"])(d,a,i,!1,null,null,null);e["a"]=h.exports},"8cfb":function(t,e,s){"use strict";s("6256")},"8f7f":function(t,e,s){"use strict";s("eb5e")},"8fe3":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.task?s("div",{staticClass:"task-item"},[t.isConfirmTask?t._e():s("set-task-state-check",{attrs:{task:t.task},on:{"update:task":function(e){t.task=e}}}),s("span",{staticClass:"set-assignee",on:{click:function(e){t.isConfirmTask||t.handleOpenAssigneeDialog()}}},[s("user-avatar",{attrs:{user:t.task.assignee,width:24,"font-size":10,"line-height":22,"border-radius":50}}),s("dialog-assignee",{ref:"dialog_assignee",attrs:{"task-id":t.task.task_id},on:{"update:taskId":function(e){return t.$set(t.task,"task_id",e)},"update:task-id":function(e){return t.$set(t.task,"task_id",e)}}})],1),t.showAction?[t.isConfirmTask?t._e():s("span",{staticClass:"action delete",on:{click:t.deleteTask}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1)]:t._e(),s("div",{staticClass:"task-header",style:t.taskId?"width: 90%":""},[s("span",{staticClass:"task-name"},[s("a",{on:{click:function(e){return t.setSelected(t.task.task_id)}}},[t._v(t._s(t.task.name))])]),t.isShowProject&&t.task.project?s("span",{staticClass:"project-name",domProps:{textContent:t._s(t.task.project.name)}}):t._e(),s("span",{staticClass:"task-date",domProps:{textContent:t._s(t.formatDate(t.task.deadline_from)+" - "+t.formatDate(t.task.deadline_to))}})]),s("div",{staticClass:"task-info"},[t.isConfirmTask?t._e():[s("task-state",{attrs:{task:t.task},on:{"update:task":function(e){t.task=e}}}),t.task.priority?s("span",{staticClass:"priority",class:"priority-"+t.task.priority},[t._v(t._s(t.getPriorityTextById(t.task.priority)))]):t._e()],t.isConfirmTask?[s("span",{staticClass:"confirm-action"},[t._t("confirm-action")],2)]:t._e(),s("span",{staticClass:"user-created"},[t._v("Tạo bởi "+t._s(t.task.user.name.substr(0,20)))]),t.task.extend_state&&!t.isConfirmTask?s("span",{staticClass:"state",class:"state-"+t.task.extend_state,staticStyle:{"padding-right":"5px"}},[t._v(t._s(t.getStateTextById(t.task.extend_state)))]):t._e()],2),!t.isConfirmTask&&t.task.sub_tasks?s("div",{staticClass:"task-subtask"},t._l(t.task.sub_tasks,(function(t){return s("sub-task-item",{key:t.task_id,attrs:{task:t}})})),1):t._e()],2):t._e()},i=[],n=s("1da1"),r=(s("96cf"),s("b0c0"),s("cc1d")),o=s("b199"),c=s("3220"),l=s("857d"),d=s("941b"),u=s("c445"),h=s("3b86"),m={components:{TaskState:c["a"],SetTaskStateCheck:l["a"],DialogAssignee:d["a"],SubTaskItem:u["a"],UserAvatar:h["a"]},props:{task:{type:Object,default:function(){}},showAction:{type:Boolean,default:!0},isShowProject:{type:Boolean,default:!1},isConfirmTask:{type:Boolean,default:!1}},computed:{projectName:function(){var t=this.task;return t.project?t.project.name:"Công việc của tôi"},taskId:function(){return this.$route.query.task_id}},created:function(){this.STATE_DONE=r["b"]},methods:{getPriorityTextById:r["s"],getStateTextById:r["u"],deleteTask:function(){var t=this,e=this.task;e.task_id&&this.$confirm("Xác nhận xóa công việc?","Warning",{confirmButtonText:"Xác nhận",cancelButtonText:"Đóng",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:Object(o["h"])(e.task_id).then((function(e){t.$route.params.projectId&&t.$store.dispatch("report/fetchReportUser",t.$route.params.projectId),t.$message.success("Xóa công việc thành công"),t.$emit("reloadList")}));case 1:case"end":return s.stop()}}),s)})))).catch((function(t){console.error(t)}))},handleOpenAssigneeDialog:function(){this.$refs.dialog_assignee.showDialog()},setSelected:function(){var t=this.task;t.task_id&&(this.$store.dispatch("task/setSelectedTask",t.task_id),this.isConfirmTask&&this.$store.getters.selectedProjectId!==t.project.project_id&&this.$store.dispatch("project/setSelectedProjectId",t.project.project_id))},markTaskDone:function(t){var e=this,s=t?r["b"]:r["h"],a=this.task;a&&Object(o["s"])(a.task_id,{state:s}).then((function(t){e.$message.success("Cập nhật thành công")}))}}},p=m,f=(s("4bae"),s("89c5"),s("2877")),g=Object(f["a"])(p,a,i,!1,null,"0cfd837f",null);e["a"]=g.exports},9292:function(t,e,s){},"92cd":function(t,e,s){},"92d7":function(t,e,s){},"941b":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"Giao cho",visible:t.dialogFormVisible,width:"300px","append-to-body":""},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-data assignee-form",staticStyle:{width:"100%"},attrs:{"label-position":"top","label-width":"160px",size:"small"}},[s("el-form-item",{attrs:{label:"Chọn user"}},[s("el-select",{attrs:{filterable:""},on:{change:t.handleChangeAssignee},model:{value:t.assignee_id,callback:function(e){t.assignee_id=e},expression:"assignee_id"}},t._l(t.membersInProject,(function(t){return s("el-option",{key:t.user_id,attrs:{label:t.name,value:t.user_id}})})),1)],1)],1)],1)},i=[],n=s("1da1"),r=(s("96cf"),s("a9e3"),s("d3b7"),s("b199")),o=s("24d2"),c=s("323e"),l=s.n(c),d=s("2769"),u=s.n(d),h={name:"CreateTagDialog",props:{taskId:{type:Number,default:0},checkListId:{type:Number,default:0},isAll:{type:Boolean,default:!0},projectId:{type:Number,default:-1}},data:function(){return{dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,assignee_id:null,rules:{},members:{}}},computed:{users:function(){return this.$store.getters.users},membersInProject:function(){return-1===this.projectId?this.$store.getters["project/members"]:this.members},user:function(){return this.$store.getters["user/profile"]},project:function(){return this.$store.getters.selectedProject}},created:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(-1===t.projectId){e.next=5;break}return e.next=3,Object(o["k"])(t.projectId);case 3:s=e.sent,t.members=s.data;case 5:case"end":return e.stop()}}),e)})))()},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},handleChangeAssignee:function(){var t=this,e=this.assignee_id,s=this.taskId,a=this.checkListId;if(0===this.taskId)return this.$emit("passAssignee",u()(this.membersInProject,{user_id:e})),this.hideDialog(),void(this.assignee_id=null);this.loadingBtn=!0;var i=this.user.user_id===this.assignee_id?2:1;l.a.start(),a?Object(r["q"])(s,{task_check_list_id:a,assignee_id:e}).then((function(e){var s=e.data;t.$emit("updateView",s),t.$message.success("Thành công")})).finally((function(){t.loadingBtn=!1})):Object(r["p"])(s,{assignee_id:e,confirm_status:i}).then((function(e){var a=e.data;t.$store.dispatch("task/updateTasks",{task_id:s,key:"assignee",value:a}),t.loading=!1,t.$emit("newAssignee",a),t.$emit("reloadList"),t.$message({type:"success",message:"Thành công"}),t.hideDialog();var n=t.project;2===i&&n.task_summery.total_task_confirm--,t.$store.commit("project/SET_SELECTED_PROJECT",n)})).finally((function(){t.loadingBtn=!1})),this.$nextTick((function(){t.assignee_id=null,t.hideDialog(),l.a.done()}))}}},m=h,p=(s("6c00"),s("2877")),f=Object(p["a"])(m,a,i,!1,null,"2bee2579",null);e["a"]=f.exports},"959a":function(t,e,s){},"9dc4":function(t,e,s){},"9fcc":function(t,e,s){"use strict";s("cc06")},a18d:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-tooltip",{attrs:{content:t.name||"Chưa giao",placement:"top",effect:"light"}},[t.name?s("el-avatar",{style:"margin-right: 3px; background:"+t.arrColor[t.arrKeyword.indexOf(t.name.slice(0,1).toUpperCase())]+(t.disable?"; background: #000;":""),attrs:{size:"small"}},[t._v(t._s(this.renderTitle()))]):s("el-avatar",{staticStyle:{"margin-right":"3px"},attrs:{icon:"el-icon-user-solid",size:"small"}})],1)},i=[],n=(s("b0c0"),s("fb6a"),{props:{name:{type:String},isMore:{type:Boolean,default:!1},disable:{type:Boolean,default:!1}},data:function(){return{arrColor:["#FF5733","#008080","#00FFFF","#2F4F4F","#FF0000","#800080","#CD5C5C","#DC143C","#8A2BE2","#A52A2A","#21618C","#556B2F","#FF1493","#DAA520","#4B0082","#191970","#C71585","#FFA500","#FF4500","#800080","#8B4513","#4169E1","#FA8072","#3498DB","#6A5ACD","#008080","#9ACD32","#2F4F4F","#228B22","rgba(68, 68, 68, 0.8)"],arrKeyword:["A","Ă","Â","B","C","D","Đ","E","Ê","G","H","I","K","L","M","N","O","Ô","Ơ","P","Q","R","S","T","U","Ư","V","X","Y",""]}},methods:{renderTitle:function(){return this.isMore?this.name:this.name.slice(0,1).toUpperCase()}}}),r=n,o=(s("f529"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,"3de4af1c",null);e["a"]=c.exports},a688:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"percent-slide",style:{background:t.bgColor}},[s("span",{style:{width:t.percentDone+"%",background:t.slideColor}})])},i=[],n=(s("a9e3"),{name:"PercentSlide",props:{percentDone:{type:Number,default:0},bgColor:{type:String,default:"#E1E1E1"},slideColor:{type:String,default:"#39D92A"}}}),r=n,o=(s("38b4"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,"648a1cba",null);e["a"]=c.exports},a78f:function(t,e,s){},a796:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("b775"),i="/attachment/upload";function n(t){return Object(a["a"])({url:i,method:"post",data:t})}},ab4e:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"color-list"},[t._t("default"),t._l(t.taskColors,(function(e){return s("span",{key:e.task_color_id,staticClass:"opt",class:{active:e.task_color_id==t.activeColor},on:{click:function(s){return t.selectColor(e.task_color_id)}}},[s("span",{staticClass:"square",style:{backgroundColor:e.color}})])}))],2)},i=[],n=(s("a9e3"),{name:"ColorList",data:function(){return{activeColor:0}},props:{currentColor:{type:Number,default:0}},computed:{taskColors:function(){return this.$store.getters.task_colors}},mounted:function(){this.activeColor=this.currentColor},methods:{selectColor:function(t){this.activeColor=t,this.$emit("afterSelect",t)}},watch:{currentColor:function(){this.activeColor=this.currentColor}}}),r=n,o=(s("6732"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,"7faba146",null);e["a"]=c.exports},ac2d:function(t,e,s){"use strict";s("0f0b")},aea2:function(t,e,s){},b334:function(t,e,s){},b598:function(t,e,s){"use strict";s("7244")},b792:function(t,e,s){t.exports=s.p+"static/img/description.cc6645fe.png"},b7c4:function(t,e,s){"use strict";s("6580")},b805:function(t,e,s){},b96f:function(t,e,s){},ba97:function(t,e,s){t.exports=s.p+"static/img/user.7b3da99d.png"},bb27:function(t,e,s){},bd7c:function(t,e,s){},bf73:function(t,e,s){"use strict";s("81c5")},c1f2:function(t,e,s){"use strict";s("92cd")},c445:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.taskMutator&&t.visible?s("div",{staticClass:"subtask-item"},[s("span",{staticClass:"arrow"},[s("svg-icon",{attrs:{"icon-class":"arrow-right"}})],1),s("set-task-state-check",{attrs:{task:t.taskMutator},on:{"update:task":function(e){t.taskMutator=e}}}),s("div",{staticClass:"task-header"},[s("div",{staticClass:"left"},[s("span",{staticClass:"task-name"},[s("a",{on:{click:t.setSelected}},[t._v(t._s(t.taskMutator.name))])]),s("span",{staticClass:"task-info"},[t.taskMutator.deadline_from||t.taskMutator.deadline_to?s("i",[t.taskMutator.deadline_from?[t._v(t._s(t.formatDate(t.taskMutator.deadline_from))+" ")]:t._e(),t.taskMutator.deadline_from&&t.taskMutator.deadline_to?[t._v("-")]:t._e(),t.taskMutator.deadline_to?[t._v(t._s(t.formatDate(t.taskMutator.deadline_to)))]:t._e()],2):t._e(),t.taskMutator.duration?s("i",[t._v("Thời lượng: "+t._s(t.taskMutator.duration)+"h")]):t._e(),t.taskMutator.assignee?s("i",[t._v("Giao cho: "+t._s(t.taskMutator.assignee.name))]):t._e()])]),s("div",{staticClass:"right"},[s("span",{staticClass:"remove",on:{click:t.removeTask}},[s("svg-icon",{attrs:{"icon-class":"trash"}})],1),s("span",{staticClass:"set-assignee",on:{click:t.handleOpenAssigneeDialog}},[s("user-avatar",{attrs:{user:t.taskMutator.assignee,width:20,"font-size":10,"line-height":22,"border-radius":50}}),s("dialog-assignee",{ref:"dialog_assignee",attrs:{"task-id":t.taskMutator.task_id},on:{"update:taskId":function(e){return t.$set(t.taskMutator,"task_id",e)},"update:task-id":function(e){return t.$set(t.taskMutator,"task_id",e)},newAssignee:t.changeAssignee}})],1)])])],1):t._e()},i=[],n=(s("d3b7"),s("4de4"),s("857d")),r=s("b199"),o=s("323e"),c=s.n(o),l=s("941b"),d=s("3b86"),u={name:"SubTaskItem",components:{SetTaskStateCheck:n["a"],DialogAssignee:l["a"],UserAvatar:d["a"]},props:{task:{type:Object,default:function(){}},isTrello:{type:Boolean,default:!1}},data:function(){return{visible:!0,taskMutator:this.task}},computed:{taskParent:function(){return this.$store.getters.selectedTask},user:function(){return this.$store.getters["user/profile"]},setStateDone:function(){return this.$store.getters["task/setStateDone"]}},watch:{setStateDone:function(t){this.taskMutator.task_id===t&&(this.taskMutator.state=4)}},methods:{removeTask:function(){var t=this,e=this.taskMutator;e&&this.$confirm("Xác nhận xóa công việc?","Warning",{confirmButtonText:"Xác nhận",cancelButtonText:"Đóng",type:"warning"}).then((function(){c.a.start(),Object(r["h"])(e.task_id).then((function(e){t.visible=!1;var s=t.taskParent;s&&(s.sub_tasks=s.sub_tasks.filter((function(e){return e!==t.task})),t.$store.commit("task/SET_SELECTED_TASK",s)),t.$route.params.projectId&&t.$store.dispatch("report/fetchReportUser",t.$route.params.projectId)})).finally((function(){c.a.done()}))})).catch((function(){}))},setSelected:function(){this.isTrello?this.$store.commit("task/SET_SELECTED_TASK",this.taskMutator):this.$store.dispatch("task/setSelectedTask",this.taskMutator.task_id)},handleOpenAssigneeDialog:function(){this.$refs.dialog_assignee.showDialog()},changeAssignee:function(t){t.user_id===this.user.user_id&&(this.taskMutator.confirm_status=2),this.taskMutator.assignee=t}}},h=u,m=(s("490f"),s("5d7a"),s("2877")),p=Object(m["a"])(h,a,i,!1,null,"4821439b",null);e["a"]=p.exports},c570:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"500px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",staticClass:"form-target",staticStyle:{width:"100%"},attrs:{model:t.formData,"label-width":"500px","label-position":"top",rules:t.rules,size:"small"}},[s("el-form-item",{attrs:{label:"Tên mục tiêu",prop:"name"}},[s("el-input",{attrs:{placeholder:"Nhập tên mục tiêu"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),s("el-form-item",{attrs:{label:"Ngày hoàn thành mục tiêu",prop:"deadline"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"Chọn ngày hoàn thành mục tiêu",format:"dd-MM-yyyy","value-format":"timestamp","picker-options":t.pickerOptions},model:{value:t.formData.deadline,callback:function(e){t.$set(t.formData,"deadline",e)},expression:"formData.deadline"}})],1),s("el-form-item",{attrs:{label:"Người phụ trách",prop:"owner_id"}},[s("el-input",{attrs:{placeholder:"Chọn người phụ trách"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),s("user-tag",{attrs:{keyword:t.keywordAuto},on:{afterSellect:t.selectOwner}})],1),s("el-form-item",{attrs:{label:"Mô tả",prop:"description"}},[s("el-input",{attrs:{type:"textarea",placeholder:"Nhập mô tả"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),s("el-form-item",{attrs:{label:"Mục tiêu thuộc dự án"}},[s("el-input",{staticClass:"has-check",attrs:{value:t.projectName,disabled:""}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("ĐÓNG")]),s("el-button",{attrs:{type:"primary",loading:t.loadingBtn},on:{click:function(e){return t.handleCreateOrUpdate()}}},[t._v(t._s("create"==t.dialogStatus?"Thêm mới":"Cập nhật"))])],1)],1)},i=[],n=(s("a9e3"),s("b0c0"),s("498a"),s("a4d3"),s("e01a"),s("d3b7"),s("f6d4")),r=s("f0d0"),o={name:"",description:"",owner_id:"",deadline:""},c={name:"TargetFormDialog",components:{UserTag:r["a"]},data:function(){return{keyword:"",dialogStatus:"create",dialogFormVisible:!1,loading:!1,loadingBtn:!1,userList:[],textMap:{update:"Chỉnh sửa mục tiêu",create:"Tạo mới mục tiêu"},formData:o,rules:{name:[{required:!0,message:"Chưa nhập tên mục tiêu",trigger:"change"}],deadline:[{required:!0,message:"Chưa nhập tên mục tiêu",trigger:"change"}],owner_id:[{required:!0,message:"Chưa chọn người phụ trách",trigger:"change"}]},pickerOptions:{disabledDate:function(t){var e=new Date;return e.setDate(e.getDate()-1),t.getTime()<e}}}},props:{formId:{type:Number,default:0}},computed:{selectedTask:function(){return this.$store.getters.selectedTask},selectedProject:function(){return this.$store.getters.selectedProject},project:function(){var t=this.selectedTask,e=this.selectedProject;return t&&t.project?t.project:e||null},projectName:function(){var t=this.project;return t?t.name:"Công việc của tôi"},projectId:function(){var t=this.project;return t?t.project_id:0},current_project_targets:{get:function(){return this.$store.getters.current_project_targets},set:function(t){this.$store.dispatch("task/setCurrentProjectTargets",t)}},keywordAuto:function(){var t=this.keyword;return t=t.trim(),t||(this.formData.owner_id=""),t.indexOf("@")>=0?"":t}},created:function(){},watch:{formId:function(t,e){this.resetFormData(),this.dialogStatus=t?"update":"create"}},methods:{showDialog:function(){this.dialogFormVisible=!0},hideDialog:function(){this.dialogFormVisible=!1},resetFormData:function(){this.formData.name="",this.formData.description="",this.formData.owner_id="",this.formData.deadline="",this.keyword="",this.$refs["dataForm"].resetFields()},selectOwner:function(t){this.keyword="@"+t.name,this.formData.owner_id=t.user_id},fetchShareUsers:function(){var t=this,e={type:"manager"};getShareUsers(e).then((function(e){t.userList=e.data}))},handleCreateOrUpdate:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.loadingBtn=!0;var s=t.formId,a=t.formData;if(s);else{var i=t.current_project_targets,r=t.projectId;Object(n["a"])(a,r).then((function(e){t.loading=!1,t.$message({type:"success",message:"Tạo mục tiêu thành công"});var s=e.data;i.push(s),t.$emit("afterPost",s),t.current_project_targets=i,t.resetFormData(),t.hideDialog()})).finally((function(){t.loadingBtn=!1}))}}}))}}},l=c,d=(s("dab1"),s("2877")),u=Object(d["a"])(l,a,i,!1,null,null,null);e["a"]=u.exports},c5aa:function(t,e,s){},c6cb:function(t,e,s){"use strict";s("33f3")},c749:function(t,e,s){},cba9:function(t,e,s){"use strict";s("b96f")},cbf2:function(t,e,s){},cc06:function(t,e,s){},cc1d:function(t,e,s){"use strict";s.d(e,"h",(function(){return o})),s.d(e,"f",(function(){return c})),s.d(e,"b",(function(){return d})),s.d(e,"c",(function(){return u})),s.d(e,"j",(function(){return h})),s.d(e,"a",(function(){return k})),s.d(e,"i",(function(){return _})),s.d(e,"g",(function(){return v})),s.d(e,"l",(function(){return b})),s.d(e,"e",(function(){return C})),s.d(e,"d",(function(){return y})),s.d(e,"k",(function(){return w})),s.d(e,"p",(function(){return T})),s.d(e,"o",(function(){return D})),s.d(e,"m",(function(){return j})),s.d(e,"n",(function(){return x})),s.d(e,"s",(function(){return A})),s.d(e,"u",(function(){return $})),s.d(e,"t",(function(){return S})),s.d(e,"q",(function(){return I})),s.d(e,"r",(function(){return O}));var a=1,i=2,n=3,r=4,o=1,c=2,l=3,d=4,u=5,h=6,m="Thấp",p="Trung bình",f="Cao",g="Khẩn cấp",k="Chờ xác nhận",_="Chưa bắt đầu",v="Đang làm",b="Chờ review",C="Hoàn thành",y="Hoàn thành muộn",w="Quá hạn",T="TASK",D="STAFF",j="FOLLOW",x="LOOP";function A(t){return t===i?p:t===n?f:t===r?g:m}function $(t){return t===d?C:t===c?v:t===l?b:t===u?y:t===h?w:_}function S(){return[{value:c,title:v},{value:l,title:b},{value:d,title:C}]}function I(){return[{value:o,title:_},{value:c,title:v},{value:l,title:b},{value:d,title:C},{value:u,title:y},{value:h,title:w}]}function O(){return[{value:a,title:m},{value:i,title:p},{value:n,title:f},{value:r,title:g}]}},d1b2:function(t,e,s){},d262:function(t,e,s){"use strict";s("bb27")},d46a:function(t,e,s){},d4de:function(t,e,s){"use strict";s("6318")},dab1:function(t,e,s){"use strict";s("7ad0")},db37:function(t,e,s){t.exports=s.p+"static/img/no_avatar.9c80ce0c.png"},db7d:function(t,e,s){},dccc:function(t,e,s){"use strict";s("3cd4")},dd05:function(t,e,s){"use strict";s("1a82")},df10:function(t,e,s){},e5b4:function(t,e,s){"use strict";s("ea77")},e96a:function(t,e,s){"use strict";s("b334")},ea77:function(t,e,s){},eb5e:function(t,e,s){},ebb7:function(t,e,s){"use strict";s("a78f")},ee32:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAD7SURBVHgBnVLLbQJBDH2eJApRDpncklM2FaSFlJAOkhKCBEicWE4cQGJLoAOgBCoBTnBjkUAsQmDshYXhJz5P2pVt+fl53gywxluJvfcK13EEWrdVtklOMaHM38bglxl/8hX3SUQoMFDDAq1+jmrkyYTpHANciMkdXk0UweIKPM3xcu/kDVkhPNUs59DhPxq7pP9ohKEGoU+hGtPPU8f6KwNSj7D0cEhC6hmBjGQhFKWhLa55sTFSw2xrkHFJ0ThWS6sCz/DZy1A3qbl9O0q6VhIr0a2Juj2qdCluIm3Wk1v35WV0T043+BBTVr36E5cCyb9wBsRo9rIULAE3Sl0DEl87LgAAAABJRU5ErkJggg=="},ee40:function(t,e,s){},f0d0:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:t.keyword,expression:"keyword"}],staticClass:"user-tag-wrapper"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.keyword,expression:"keyword"}],staticClass:"user-tag-list custom-scroll"},t._l(t.users,(function(e){return s("div",{key:e.user_id,staticClass:"item",on:{click:function(s){return t.chooseUser(e)}}},[s("span",{staticClass:"avatar"},[e.avatar?s("img",{attrs:{src:e.avatar}}):s("span",{staticClass:"no-image"},[t._v(t._s(e.name.slice(0,1).toUpperCase()))])]),s("span",{staticClass:"info"},[s("span",{staticClass:"bold"},[t._v("@"+t._s(e.name))]),s("span",{staticClass:"sub pl-5"},[s("em",[t._v(t._s(e.user_group_name||"Chưa có bộ phận"))])])])])})),0)])},i=[],n=(s("4de4"),s("caad"),s("2532"),s("b0c0"),{props:{keyword:{type:String,default:""}},computed:{users:function(){var t=this.keyword,e=this.$store.getters.users;return e.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())}))}},watch:{},methods:{chooseUser:function(t){this.$emit("afterSellect",t)}}}),r=n,o=(s("b7c4"),s("2877")),c=Object(o["a"])(r,a,i,!1,null,"4e55e6ff",null);e["a"]=c.exports},f17a:function(t,e,s){"use strict";s("92d7")},f1af:function(t,e,s){"use strict";s("9dc4")},f27c:function(t,e,s){},f529:function(t,e,s){"use strict";s("0526")},fdf6:function(t,e,s){"use strict";s("50a7")}}]);