(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-203e032f"],{"2feb":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ww-confirmation",class:t.selectedId?"custom-container":""},[t.selectedId?t._e():s("header",[s("el-select",{staticClass:"item",attrs:{size:"mini",filterable:"",clearable:"",placeholder:"Tất cả dự án"},on:{change:function(e){return t.change(!0,!0)}},model:{value:t.filter.project_id,callback:function(e){t.$set(t.filter,"project_id",e)},expression:"filter.project_id"}},t._l(t.projects,(function(t){return s("el-option",{key:t.project_id,staticClass:"custom-item",attrs:{label:t.name,value:t.project_id}})})),1),s("el-select",{attrs:{size:"mini",filterable:"","reserve-keyword":"",clearable:"",placeholder:"Tên người giao"},on:{change:function(e){return t.change(!0,!1)}},model:{value:t.filter.user_id,callback:function(e){t.$set(t.filter,"user_id",e)},expression:"filter.user_id"}},[s("el-option",{staticClass:"custom-item",attrs:{label:"Chưa gán",value:"-1"}}),t._l(t.usersFilter,(function(t){return s("el-option",{key:t.user_id,staticClass:"custom-item",attrs:{label:t.name,value:t.user_id}})}))],2),s("el-select",{attrs:{size:"mini",filterable:"","reserve-keyword":"",clearable:"",placeholder:"Tên người xử lý"},on:{change:function(e){return t.change(!1,!0)}},model:{value:t.filter.assignee_id,callback:function(e){t.$set(t.filter,"assignee_id",e)},expression:"filter.assignee_id"}},[s("el-option",{staticClass:"custom-item",attrs:{label:"Chưa gán",value:"-1"}}),t._l(t.usersFilter,(function(t){return s("el-option",{key:t.user_id,staticClass:"custom-item",attrs:{label:t.name,value:t.user_id}})}))],2),s("el-select",{attrs:{size:"mini",filterable:"","reserve-keyword":"",clearable:"",placeholder:"Trạng thái"},on:{change:function(e){return t.change(!1,!0)}},model:{value:t.filter.confirm_status,callback:function(e){t.$set(t.filter,"confirm_status",e)},expression:"filter.confirm_status"}},t._l(t.status,(function(t){return s("el-option",{key:t.id,staticClass:"custom-item",attrs:{label:t.name,value:t.id}})})),1)],1),s("section",{staticClass:"task-group-wrapper"},[s("el-row",[s("el-col",{attrs:{span:t.isSelectId?6:24}},[s("div",{staticClass:"task-group-item"},[s("el-collapse",{model:{value:t.collapse_active,callback:function(e){t.collapse_active=e},expression:"collapse_active"}},[s("el-collapse-item",{attrs:{title:"Chờ xác nhận ("+(t.filter.confirm_status?0:t.tasksConfirm.length)+")",name:"1"}},[t.filter.confirm_status?t._e():t._l(t.tasksConfirm,(function(e){return s("task-item",{key:e.task_id,class:{active:e.task_id==t.selectedId},attrs:{task:e,"is-confirm-task":!0,"is-show-project":!0,"confirm-actions":[!0,!1,!0,!1]},on:{reloadList:function(e){return t.change(!0,!1)}},scopedSlots:t._u([{key:"confirm-action",fn:function(){return[s("el-button",{attrs:{type:"success",round:"",size:"mini"},on:{click:function(s){return t.changeConfirmStatus(e,2,!1)}}},[t._v("Chấp nhận")]),s("el-button",{attrs:{type:"danger",round:"",size:"mini"},on:{click:function(s){return t.dialogConfirmRejectShow(e)}}},[t._v("Từ chối")])]},proxy:!0}],null,!0)})}))],2),s("el-collapse-item",{attrs:{name:"2"}},[s("template",{slot:"title"},[s("span",{staticClass:"task-group-item__title title"},[t._v(" Giao việc ("+t._s(t.pagination.total)+") ")]),s("span",{staticClass:"action",on:{click:function(e){return t.callTaskForm()}}},[s("span",{staticClass:"add"},[s("svg-icon",{attrs:{"icon-class":"add"}}),t._v(" Thêm công việc ")],1)])]),t._l(t.tasksAssign,(function(e){return s("task-item",{key:e.task_id,class:{active:e.task_id==t.selectedId},attrs:{task:e,"is-confirm-task":!0,"is-show-project":!0},on:{reloadList:function(e){return t.change(!1,!0)}}},[s("template",{slot:"confirm-action"},[e.confirm_status===t.confirmStatus.accepted?s("el-button",{attrs:{disabled:"",type:"success",round:"",size:"mini"}},[t._v("Chấp nhận")]):t._e(),e.confirm_status===t.confirmStatus.pending?s("el-button",{attrs:{disabled:"",type:"primary",round:"",plain:"",size:"mini"}},[t._v("Đang chờ")]):t._e(),e.confirm_status===t.confirmStatus.rejected?s("el-button",{attrs:{disabled:"",type:"danger",round:"",size:"mini"}},[t._v("Từ chối")]):t._e(),s("el-button",{attrs:{type:"primary",round:"",size:"mini"},on:{click:function(s){return t.changeConfirmStatus(e,1)}}},[t._v("Gửi lại")])],1)],2)})),s("el-pagination",{attrs:{layout:"prev, pager, next","page-size":t.pagination.per_page,"current-page":t.pagination.current_page,total:t.pagination.total},on:{"current-change":t.changeCurrentPage}})],2)],1)],1)]),s("el-col",{directives:[{name:"show",rawName:"v-show",value:t.isSelectId,expression:"isSelectId"}],staticClass:"detail-wrapper custom-scroll",attrs:{span:12}},[s("a",{staticClass:"close-detail",on:{click:t.closeDetail}},[s("svg-icon",{attrs:{"icon-class":"plus"}})],1),t.isSelectId?s("task-detail",{attrs:{"task-id":t.selectedId,"confirmation-screen":!0}}):t._e()],1),t.selectedId?s("el-col",{staticClass:"custom-scroll",attrs:{span:6}},[s("right-bar",{attrs:{"percen-task-done":50,"project-of-me":!0}})],1):t._e()],1)],1),s("task-form",{ref:"taskForm",attrs:{"confirm-project-id":t.$store.getters.selectedProjectId,"is-show-project-select":!0,"form-id":t.resendId,"task-group-id":0},on:{reloadList:function(e){return t.change()}}}),s("el-dialog",{attrs:{title:"Xác nhận thông tin",visible:t.dialogConfirmReject,width:"500px"},on:{"update:visible":function(e){t.dialogConfirmReject=e}}},[s("el-form",{attrs:{model:t.formData}},[s("el-form-item",{attrs:{label:"Vì sao bạn lại từ chối công việc?"}},[s("el-input",{attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:t.formData.reason,callback:function(e){t.$set(t.formData,"reason",e)},expression:"formData.reason"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogConfirmReject=!1}}},[t._v("Đóng")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.changeConfirmStatus(t.task,3,!1)}}},[t._v("Xác nhận")])],1)],1)],1)},n=[],i=s("1da1"),r=(s("96cf"),s("4de4"),s("24d2")),o=s("c24f"),c=s("8fe3"),l=s("8266"),u=s("b199"),d=s("7f6d"),f=s("828d"),m={components:{TaskItem:c["a"],TaskForm:l["a"],RightBar:f["a"],TaskDetail:d["a"]},data:function(){return{confirmStatus:{pending:1,accepted:2,rejected:3},collapse_active:["1","2"],projects:{},users:{},filter:{project_id:"",user_id:"",assignee_id:"",confirm_status:""},status:[{id:3,name:"Từ chối"},{id:1,name:"Đang chờ"}],tasks:[],tasksAssign:[],tasksConfirm:[],assignee:{task_id:0,project_id:-1},pagination:{total:0,per_page:0,current_page:1,total_pages:0},resendId:0,dialogConfirmReject:!1,formData:{reason:""},task:"",task_group_id:0}},computed:{usersFilter:function(){var t=this;return t.users.length>0?t.users.filter((function(e){if(e.project_id.length>0)return e.project_id.filter((function(e){return!t.filter.project_id||e===t.filter.project_id})).length>0})):[]},selectedId:{get:function(){return this.$store.getters.selectedTaskId||0},set:function(t){this.$store.dispatch("task/setSelectedTask",t)}},selectedProjectId:function(){return this.$store.getters.selectedProjectId},user:function(){return this.$store.getters["user/profile"]},isSelectId:function(){return!!this.$store.getters.selectedTaskId},taskSelected:function(){return this.$store.getters.selectedTask}},created:function(){this.fetch()},mounted:function(){this.realTimeConfirmationFromAssignee()},destroyed:function(){this.$store.commit("task/SET_SELECTED_TASK",null),this.$store.commit("task/SET_SELECTED_TASK_ID",null)},methods:{getTasksAssign:u["l"],fetch:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(r["h"])();case 2:return t.projects=e.sent.data,e.next=5,Object(o["j"])();case 5:t.users=e.sent.data.data,t.change();case 7:case"end":return e.stop()}}),e)})))()},change:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["l"])(t.filter);case 2:return s=e.sent.data,t.tasksAssign=s.data,t.pagination.current_page=s.current_page,t.pagination.total=s.total,t.pagination.per_page=s.per_page,t.pagination.total_pages=s.last_page,e.next=10,Object(u["m"])(t.filter);case 10:t.tasksConfirm=e.sent.data,t.$store.dispatch("user/getConfirmation");case 12:case"end":return e.stop()}}),e)})))()},callTaskForm:function(){this.resendId=0,this.collapse_active.push("2"),this.$refs.taskForm.callDialog()},dialogConfirmRejectShow:function(t){this.task=t,this.dialogConfirmReject=!0},changeConfirmStatus:function(t,e){var s=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(a)return this.resendId=t.task_id,this.task_group_id=t.task_group_id,this.$store.dispatch("project/fetchMembersInProject",t.project.project_id),t.project_id=t.project.project_id,void this.$refs.taskForm.callDialog(t);Object(u["s"])(t.task_id,{confirm_status:e,confirm_at:this.$moment().format("YYYY-MM-DD HH:mm:ss"),reason:this.formData.reason}).then((function(a){if(s.taskSelected&&t.task_id==s.taskSelected.task_id){var n=s.taskSelected;n.confirm_status=e,s.$store.commit("task/SET_SELECTED_TASK",n)}s.$message.success("Cập nhật thành công"),s.change(),s.dialogConfirmReject=!1}))},changeCurrentPage:function(t){this.filter.page=t,this.change()},closeDetail:function(){this.selectedId=null},realTimeConfirmationFromAssignee:function(){var t=this;Echo.channel("confirmation-channel").listen(".pushed",(function(e){e._task;t.change()}))}}},p=m,g=(s("d67e"),s("2877")),h=Object(g["a"])(p,a,n,!1,null,null,null);e["default"]=h.exports},"9a2a":function(t,e,s){},d67e:function(t,e,s){"use strict";s("9a2a")}}]);